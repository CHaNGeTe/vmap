!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("stream"),require("string_decoder")):"function"==typeof define&&define.amd?define(["stream","string_decoder"],e):t["videoJs-plugin"]=e(t.stream,t.string_decoder)}(this,function(t,e){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t,e=e&&e.hasOwnProperty("default")?e.default:e;var i,n,r,a=(function(i,n){!function(i){i.parser=function(t,e){return new a(t,e)},i.SAXParser=a,i.SAXStream=o,i.createStream=function(t,e){return new o(t,e)},i.MAX_BUFFER_LENGTH=65536;var n,r=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];function a(t,e){if(!(this instanceof a))return new a(t,e);var n=this;!function(t){for(var e=0,i=r.length;e<i;e++)t[r[e]]=""}(n),n.q=n.c="",n.bufferCheckPosition=i.MAX_BUFFER_LENGTH,n.opt=e||{},n.opt.lowercase=n.opt.lowercase||n.opt.lowercasetags,n.looseCase=n.opt.lowercase?"toLowerCase":"toUpperCase",n.tags=[],n.closed=n.closedRoot=n.sawRoot=!1,n.tag=n.error=null,n.strict=!!t,n.noscript=!(!t&&!n.opt.noscript),n.state=x.BEGIN,n.strictEntities=n.opt.strictEntities,n.ENTITIES=n.strictEntities?Object.create(i.XML_ENTITIES):Object.create(i.ENTITIES),n.attribList=[],n.opt.xmlns&&(n.ns=Object.create(d)),n.trackPosition=!1!==n.opt.position,n.trackPosition&&(n.position=n.line=n.column=0),I(n,"onready")}i.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","opentagstart","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"],Object.create||(Object.create=function(t){function e(){}return e.prototype=t,new e}),Object.keys||(Object.keys=function(t){var e=[];for(var i in t)t.hasOwnProperty(i)&&e.push(i);return e}),a.prototype={end:function(){S(this)},write:function(t){var e=this;if(this.error)throw this.error;if(e.closed)return k(e,"Cannot write after close. Assign an onready handler.");if(null===t)return S(e);"object"==typeof t&&(t=t.toString());var n=0,a="";for(;a=B(t,n++),e.c=a,a;)switch(e.trackPosition&&(e.position++,"\n"===a?(e.line++,e.column=0):e.column++),e.state){case x.BEGIN:if(e.state=x.BEGIN_WHITESPACE,"\ufeff"===a)continue;R(e,a);continue;case x.BEGIN_WHITESPACE:R(e,a);continue;case x.TEXT:if(e.sawRoot&&!e.closedRoot){for(var s=n-1;a&&"<"!==a&&"&"!==a;)(a=B(t,n++))&&e.trackPosition&&(e.position++,"\n"===a?(e.line++,e.column=0):e.column++);e.textNode+=t.substring(s,n-1)}"<"!==a||e.sawRoot&&e.closedRoot&&!e.strict?(f(a)||e.sawRoot&&!e.closedRoot||F(e,"Text data outside of root node."),"&"===a?e.state=x.TEXT_ENTITY:e.textNode+=a):(e.state=x.OPEN_WAKA,e.startTagPosition=e.position);continue;case x.SCRIPT:"<"===a?e.state=x.SCRIPT_ENDING:e.script+=a;continue;case x.SCRIPT_ENDING:"/"===a?e.state=x.CLOSE_TAG:(e.script+="<"+a,e.state=x.SCRIPT);continue;case x.OPEN_WAKA:if("!"===a)e.state=x.SGML_DECL,e.sgmlDecl="";else if(f(a));else if(b(m,a))e.state=x.OPEN_TAG,e.tagName=a;else if("/"===a)e.state=x.CLOSE_TAG,e.tagName="";else if("?"===a)e.state=x.PROC_INST,e.procInstName=e.procInstBody="";else{if(F(e,"Unencoded <"),e.startTagPosition+1<e.position){var o=e.position-e.startTagPosition;a=new Array(o).join(" ")+a}e.textNode+="<"+a,e.state=x.TEXT}continue;case x.SGML_DECL:(e.sgmlDecl+a).toUpperCase()===l?(C(e,"onopencdata"),e.state=x.CDATA,e.sgmlDecl="",e.cdata=""):e.sgmlDecl+a==="--"?(e.state=x.COMMENT,e.comment="",e.sgmlDecl=""):(e.sgmlDecl+a).toUpperCase()===c?(e.state=x.DOCTYPE,(e.doctype||e.sawRoot)&&F(e,"Inappropriately located doctype declaration"),e.doctype="",e.sgmlDecl=""):">"===a?(C(e,"onsgmldeclaration",e.sgmlDecl),e.sgmlDecl="",e.state=x.TEXT):T(a)?(e.state=x.SGML_DECL_QUOTED,e.sgmlDecl+=a):e.sgmlDecl+=a;continue;case x.SGML_DECL_QUOTED:a===e.q&&(e.state=x.SGML_DECL,e.q=""),e.sgmlDecl+=a;continue;case x.DOCTYPE:">"===a?(e.state=x.TEXT,C(e,"ondoctype",e.doctype),e.doctype=!0):(e.doctype+=a,"["===a?e.state=x.DOCTYPE_DTD:T(a)&&(e.state=x.DOCTYPE_QUOTED,e.q=a));continue;case x.DOCTYPE_QUOTED:e.doctype+=a,a===e.q&&(e.q="",e.state=x.DOCTYPE);continue;case x.DOCTYPE_DTD:e.doctype+=a,"]"===a?e.state=x.DOCTYPE:T(a)&&(e.state=x.DOCTYPE_DTD_QUOTED,e.q=a);continue;case x.DOCTYPE_DTD_QUOTED:e.doctype+=a,a===e.q&&(e.state=x.DOCTYPE_DTD,e.q="");continue;case x.COMMENT:"-"===a?e.state=x.COMMENT_ENDING:e.comment+=a;continue;case x.COMMENT_ENDING:"-"===a?(e.state=x.COMMENT_ENDED,e.comment=N(e.opt,e.comment),e.comment&&C(e,"oncomment",e.comment),e.comment=""):(e.comment+="-"+a,e.state=x.COMMENT);continue;case x.COMMENT_ENDED:">"!==a?(F(e,"Malformed comment"),e.comment+="--"+a,e.state=x.COMMENT):e.state=x.TEXT;continue;case x.CDATA:"]"===a?e.state=x.CDATA_ENDING:e.cdata+=a;continue;case x.CDATA_ENDING:"]"===a?e.state=x.CDATA_ENDING_2:(e.cdata+="]"+a,e.state=x.CDATA);continue;case x.CDATA_ENDING_2:">"===a?(e.cdata&&C(e,"oncdata",e.cdata),C(e,"onclosecdata"),e.cdata="",e.state=x.TEXT):"]"===a?e.cdata+="]":(e.cdata+="]]"+a,e.state=x.CDATA);continue;case x.PROC_INST:"?"===a?e.state=x.PROC_INST_ENDING:f(a)?e.state=x.PROC_INST_BODY:e.procInstName+=a;continue;case x.PROC_INST_BODY:if(!e.procInstBody&&f(a))continue;"?"===a?e.state=x.PROC_INST_ENDING:e.procInstBody+=a;continue;case x.PROC_INST_ENDING:">"===a?(C(e,"onprocessinginstruction",{name:e.procInstName,body:e.procInstBody}),e.procInstName=e.procInstBody="",e.state=x.TEXT):(e.procInstBody+="?"+a,e.state=x.PROC_INST_BODY);continue;case x.OPEN_TAG:b(y,a)?e.tagName+=a:(L(e),">"===a?O(e):"/"===a?e.state=x.OPEN_TAG_SLASH:(f(a)||F(e,"Invalid character in tag name"),e.state=x.ATTRIB));continue;case x.OPEN_TAG_SLASH:">"===a?(O(e,!0),M(e)):(F(e,"Forward-slash in opening tag not followed by >"),e.state=x.ATTRIB);continue;case x.ATTRIB:if(f(a))continue;">"===a?O(e):"/"===a?e.state=x.OPEN_TAG_SLASH:b(m,a)?(e.attribName=a,e.attribValue="",e.state=x.ATTRIB_NAME):F(e,"Invalid attribute name");continue;case x.ATTRIB_NAME:"="===a?e.state=x.ATTRIB_VALUE:">"===a?(F(e,"Attribute without value"),e.attribValue=e.attribName,P(e),O(e)):f(a)?e.state=x.ATTRIB_NAME_SAW_WHITE:b(y,a)?e.attribName+=a:F(e,"Invalid attribute name");continue;case x.ATTRIB_NAME_SAW_WHITE:if("="===a)e.state=x.ATTRIB_VALUE;else{if(f(a))continue;F(e,"Attribute without value"),e.tag.attributes[e.attribName]="",e.attribValue="",C(e,"onattribute",{name:e.attribName,value:""}),e.attribName="",">"===a?O(e):b(m,a)?(e.attribName=a,e.state=x.ATTRIB_NAME):(F(e,"Invalid attribute name"),e.state=x.ATTRIB)}continue;case x.ATTRIB_VALUE:if(f(a))continue;T(a)?(e.q=a,e.state=x.ATTRIB_VALUE_QUOTED):(F(e,"Unquoted attribute value"),e.state=x.ATTRIB_VALUE_UNQUOTED,e.attribValue=a);continue;case x.ATTRIB_VALUE_QUOTED:if(a!==e.q){"&"===a?e.state=x.ATTRIB_VALUE_ENTITY_Q:e.attribValue+=a;continue}P(e),e.q="",e.state=x.ATTRIB_VALUE_CLOSED;continue;case x.ATTRIB_VALUE_CLOSED:f(a)?e.state=x.ATTRIB:">"===a?O(e):"/"===a?e.state=x.OPEN_TAG_SLASH:b(m,a)?(F(e,"No whitespace between attributes"),e.attribName=a,e.attribValue="",e.state=x.ATTRIB_NAME):F(e,"Invalid attribute name");continue;case x.ATTRIB_VALUE_UNQUOTED:if(">"!==(d=a)&&!f(d)){"&"===a?e.state=x.ATTRIB_VALUE_ENTITY_U:e.attribValue+=a;continue}P(e),">"===a?O(e):e.state=x.ATTRIB;continue;case x.CLOSE_TAG:if(e.tagName)">"===a?M(e):b(y,a)?e.tagName+=a:e.script?(e.script+="</"+e.tagName,e.tagName="",e.state=x.SCRIPT):(f(a)||F(e,"Invalid tagname in closing tag"),e.state=x.CLOSE_TAG_SAW_WHITE);else{if(f(a))continue;b(m,a)?e.tagName=a:e.script?(e.script+="</"+a,e.state=x.SCRIPT):F(e,"Invalid tagname in closing tag.")}continue;case x.CLOSE_TAG_SAW_WHITE:if(f(a))continue;">"===a?M(e):F(e,"Invalid characters in closing tag");continue;case x.TEXT_ENTITY:case x.ATTRIB_VALUE_ENTITY_Q:case x.ATTRIB_VALUE_ENTITY_U:var u,p;switch(e.state){case x.TEXT_ENTITY:u=x.TEXT,p="textNode";break;case x.ATTRIB_VALUE_ENTITY_Q:u=x.ATTRIB_VALUE_QUOTED,p="attribValue";break;case x.ATTRIB_VALUE_ENTITY_U:u=x.ATTRIB_VALUE_UNQUOTED,p="attribValue"}";"===a?(e[p]+=V(e),e.entity="",e.state=u):b(e.entity.length?h:g,a)?e.entity+=a:(F(e,"Invalid character in entity name"),e[p]+="&"+e.entity+a,e.entity="",e.state=u);continue;default:throw new Error(e,"Unknown state: "+e.state)}var d;e.position>=e.bufferCheckPosition&&function(t){for(var e=Math.max(i.MAX_BUFFER_LENGTH,10),n=0,a=0,s=r.length;a<s;a++){var o=t[r[a]].length;if(o>e)switch(r[a]){case"textNode":w(t);break;case"cdata":C(t,"oncdata",t.cdata),t.cdata="";break;case"script":C(t,"onscript",t.script),t.script="";break;default:k(t,"Max buffer length exceeded: "+r[a])}n=Math.max(n,o)}var l=i.MAX_BUFFER_LENGTH-n;t.bufferCheckPosition=l+t.position}(e);return e},resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){var t;w(t=this),""!==t.cdata&&(C(t,"oncdata",t.cdata),t.cdata=""),""!==t.script&&(C(t,"onscript",t.script),t.script="")}};try{n=t.Stream}catch(t){n=function(){}}var s=i.EVENTS.filter(function(t){return"error"!==t&&"end"!==t});function o(t,e){if(!(this instanceof o))return new o(t,e);n.apply(this),this._parser=new a(t,e),this.writable=!0,this.readable=!0;var i=this;this._parser.onend=function(){i.emit("end")},this._parser.onerror=function(t){i.emit("error",t),i._parser.error=null},this._decoder=null,s.forEach(function(t){Object.defineProperty(i,"on"+t,{get:function(){return i._parser["on"+t]},set:function(e){if(!e)return i.removeAllListeners(t),i._parser["on"+t]=e,e;i.on(t,e)},enumerable:!0,configurable:!1})})}o.prototype=Object.create(n.prototype,{constructor:{value:o}}),o.prototype.write=function(t){if("function"==typeof Buffer&&"function"==typeof Buffer.isBuffer&&Buffer.isBuffer(t)){if(!this._decoder){var i=e.StringDecoder;this._decoder=new i("utf8")}t=this._decoder.write(t)}return this._parser.write(t.toString()),this.emit("data",t),!0},o.prototype.end=function(t){return t&&t.length&&this.write(t),this._parser.end(),!0},o.prototype.on=function(t,e){var i=this;return i._parser["on"+t]||-1===s.indexOf(t)||(i._parser["on"+t]=function(){var e=1===arguments.length?[arguments[0]]:Array.apply(null,arguments);e.splice(0,0,t),i.emit.apply(i,e)}),n.prototype.on.call(i,t,e)};var l="[CDATA[",c="DOCTYPE",u="http://www.w3.org/XML/1998/namespace",p="http://www.w3.org/2000/xmlns/",d={xml:u,xmlns:p},m=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,y=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/,g=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,h=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/;function f(t){return" "===t||"\n"===t||"\r"===t||"\t"===t}function T(t){return'"'===t||"'"===t}function b(t,e){return t.test(e)}var E,v,A,x=0;i.STATE={BEGIN:x++,BEGIN_WHITESPACE:x++,TEXT:x++,TEXT_ENTITY:x++,OPEN_WAKA:x++,SGML_DECL:x++,SGML_DECL_QUOTED:x++,DOCTYPE:x++,DOCTYPE_QUOTED:x++,DOCTYPE_DTD:x++,DOCTYPE_DTD_QUOTED:x++,COMMENT_STARTING:x++,COMMENT:x++,COMMENT_ENDING:x++,COMMENT_ENDED:x++,CDATA:x++,CDATA_ENDING:x++,CDATA_ENDING_2:x++,PROC_INST:x++,PROC_INST_BODY:x++,PROC_INST_ENDING:x++,OPEN_TAG:x++,OPEN_TAG_SLASH:x++,ATTRIB:x++,ATTRIB_NAME:x++,ATTRIB_NAME_SAW_WHITE:x++,ATTRIB_VALUE:x++,ATTRIB_VALUE_QUOTED:x++,ATTRIB_VALUE_CLOSED:x++,ATTRIB_VALUE_UNQUOTED:x++,ATTRIB_VALUE_ENTITY_Q:x++,ATTRIB_VALUE_ENTITY_U:x++,CLOSE_TAG:x++,CLOSE_TAG_SAW_WHITE:x++,SCRIPT:x++,SCRIPT_ENDING:x++},i.XML_ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'"},i.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,int:8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(i.ENTITIES).forEach(function(t){var e=i.ENTITIES[t],n="number"==typeof e?String.fromCharCode(e):e;i.ENTITIES[t]=n});for(var _ in i.STATE)i.STATE[i.STATE[_]]=_;function I(t,e,i){t[e]&&t[e](i)}function C(t,e,i){t.textNode&&w(t),I(t,e,i)}function w(t){t.textNode=N(t.opt,t.textNode),t.textNode&&I(t,"ontext",t.textNode),t.textNode=""}function N(t,e){return t.trim&&(e=e.trim()),t.normalize&&(e=e.replace(/\s+/g," ")),e}function k(t,e){return w(t),t.trackPosition&&(e+="\nLine: "+t.line+"\nColumn: "+t.column+"\nChar: "+t.c),e=new Error(e),t.error=e,I(t,"onerror",e),t}function S(t){return t.sawRoot&&!t.closedRoot&&F(t,"Unclosed root tag"),t.state!==x.BEGIN&&t.state!==x.BEGIN_WHITESPACE&&t.state!==x.TEXT&&k(t,"Unexpected end"),w(t),t.c="",t.closed=!0,I(t,"onend"),a.call(t,t.strict,t.opt),t}function F(t,e){if("object"!=typeof t||!(t instanceof a))throw new Error("bad call to strictFail");t.strict&&k(t,e)}function L(t){t.strict||(t.tagName=t.tagName[t.looseCase]());var e=t.tags[t.tags.length-1]||t,i=t.tag={name:t.tagName,attributes:{}};t.opt.xmlns&&(i.ns=e.ns),t.attribList.length=0,C(t,"onopentagstart",i)}function D(t,e){var i=t.indexOf(":")<0?["",t]:t.split(":"),n=i[0],r=i[1];return e&&"xmlns"===t&&(n="xmlns",r=""),{prefix:n,local:r}}function P(t){if(t.strict||(t.attribName=t.attribName[t.looseCase]()),-1!==t.attribList.indexOf(t.attribName)||t.tag.attributes.hasOwnProperty(t.attribName))t.attribName=t.attribValue="";else{if(t.opt.xmlns){var e=D(t.attribName,!0),i=e.prefix,n=e.local;if("xmlns"===i)if("xml"===n&&t.attribValue!==u)F(t,"xml: prefix must be bound to "+u+"\nActual: "+t.attribValue);else if("xmlns"===n&&t.attribValue!==p)F(t,"xmlns: prefix must be bound to "+p+"\nActual: "+t.attribValue);else{var r=t.tag,a=t.tags[t.tags.length-1]||t;r.ns===a.ns&&(r.ns=Object.create(a.ns)),r.ns[n]=t.attribValue}t.attribList.push([t.attribName,t.attribValue])}else t.tag.attributes[t.attribName]=t.attribValue,C(t,"onattribute",{name:t.attribName,value:t.attribValue});t.attribName=t.attribValue=""}}function O(t,e){if(t.opt.xmlns){var i=t.tag,n=D(t.tagName);i.prefix=n.prefix,i.local=n.local,i.uri=i.ns[n.prefix]||"",i.prefix&&!i.uri&&(F(t,"Unbound namespace prefix: "+JSON.stringify(t.tagName)),i.uri=n.prefix);var r=t.tags[t.tags.length-1]||t;i.ns&&r.ns!==i.ns&&Object.keys(i.ns).forEach(function(e){C(t,"onopennamespace",{prefix:e,uri:i.ns[e]})});for(var a=0,s=t.attribList.length;a<s;a++){var o=t.attribList[a],l=o[0],c=o[1],u=D(l,!0),p=u.prefix,d=u.local,m=""===p?"":i.ns[p]||"",y={name:l,value:c,prefix:p,local:d,uri:m};p&&"xmlns"!==p&&!m&&(F(t,"Unbound namespace prefix: "+JSON.stringify(p)),y.uri=p),t.tag.attributes[l]=y,C(t,"onattribute",y)}t.attribList.length=0}t.tag.isSelfClosing=!!e,t.sawRoot=!0,t.tags.push(t.tag),C(t,"onopentag",t.tag),e||(t.noscript||"script"!==t.tagName.toLowerCase()?t.state=x.TEXT:t.state=x.SCRIPT,t.tag=null,t.tagName=""),t.attribName=t.attribValue="",t.attribList.length=0}function M(t){if(!t.tagName)return F(t,"Weird empty close tag."),t.textNode+="</>",void(t.state=x.TEXT);if(t.script){if("script"!==t.tagName)return t.script+="</"+t.tagName+">",t.tagName="",void(t.state=x.SCRIPT);C(t,"onscript",t.script),t.script=""}var e=t.tags.length,i=t.tagName;t.strict||(i=i[t.looseCase]());for(var n=i;e--;){if(t.tags[e].name===n)break;F(t,"Unexpected close tag")}if(e<0)return F(t,"Unmatched closing tag: "+t.tagName),t.textNode+="</"+t.tagName+">",void(t.state=x.TEXT);t.tagName=i;for(var r=t.tags.length;r-- >e;){var a=t.tag=t.tags.pop();t.tagName=t.tag.name,C(t,"onclosetag",t.tagName);var s={};for(var o in a.ns)s[o]=a.ns[o];var l=t.tags[t.tags.length-1]||t;t.opt.xmlns&&a.ns!==l.ns&&Object.keys(a.ns).forEach(function(e){var i=a.ns[e];C(t,"onclosenamespace",{prefix:e,uri:i})})}0===e&&(t.closedRoot=!0),t.tagName=t.attribValue=t.attribName="",t.attribList.length=0,t.state=x.TEXT}function V(t){var e,i=(t=nd).entity,n=i.toLowerCase(),r="";return t.ENTITIES[i]?t.ENTITIES[i]:t.ENTITIES[n]?t.ENTITIES[n]:("#"===(i=n).charAt(0)&&("x"===i.charAt(1)?(i=i.slice(2),r=(e=parseInt(i,16)).toString(16)):(i=i.slice(1),r=(e=parseInt(i,10)).toString(10))),i=i.replace(/^0+/,""),isNaN(e)||r.toLowerCase()!==i?(F(t,"Invalid character entity"),"&"+t.entity+";"):String.fromCodePoint(e))}function R(t,e){"<"===e?(t.state=x.OPEN_WAKA,t.startTagPosition=t.position):f(e)||(F(t,"Non-whitespace before first tag."),t.textNode=e,t.state=x.TEXT)}function B(t,e){var i="";return e<t.length&&(i=t.charAt(e)),i}x=i.STATE,String.fromCodePoint||(E=String.fromCharCode,v=Math.floor,A=function(){var t,e,i=[],n=-1,r=arguments.length;if(!r)return"";for(var a="";++n<r;){var s=Number(arguments[n]);if(!isFinite(s)||s<0||s>1114111||v(s)!==s)throw RangeError("Invalid code point: "+s);s<=65535?i.push(s):(t=55296+((s-=65536)>>10),e=s%1024+56320,i.push(t,e)),(n+1===r||i.length>16384)&&(a+=E.apply(null,i),i.length=0)}return a},Object.defineProperty?Object.defineProperty(String,"fromCodePoint",{value:A,configurable:!0,writable:!0}):String.fromCodePoint=A)}(n)}(i={exports:{}},i.exports),i.exports),s={copyOptions:function(t){var e,i={};for(e in t)t.hasOwnProperty(e)&&(i[e]=t[e]);return i},ensureFlagExists:function(t,e){t in e&&"boolean"==typeof e[t]||(e[t]=!1)},ensureSpacesExists:function(t){"spaces"in t&&("number"==typeof t.spaces||"string"==typeof t.spaces)||(t.spaces=0)},ensureKeyExists:function(t,e){t+"Key"in e&&"string"==typeof e[t+"Key"]||(e[t+"Key"]=e.compact?"_"+t:t)},checkFnExists:function(t,e){return t+"Fn"in e}},o=function(t){return Array.isArray?Array.isArray(t):"[object Array]"===Object.prototype.toString.call(t)},l=o;function c(t,e){var i;if(n.compact){if(!r[n[t+"Key"]]&&n.alwaysArray&&(r[n[t+"Key"]]=[]),r[n[t+"Key"]]&&!l(r[n[t+"Key"]])&&(r[n[t+"Key"]]=[r[n[t+"Key"]]]),t+"Fn"in n&&"string"==typeof e&&(e=n[t+"Fn"](e,r)),"instruction"===t&&("instructionFn"in n||"instructionNameFn"in n))for(i in e)if(e.hasOwnProperty(i))if("instructionFn"in n)e[i]=n.instructionFn(e[i],i,r);else{var a=e[i];delete e[i],e[n.instructionNameFn(i,a,r)]=a}l(r[n[t+"Key"]])?r[n[t+"Key"]].push(e):r[n[t+"Key"]]=e}else{r[n.elementsKey]||(r[n.elementsKey]=[]);var s={};if(s[n.typeKey]=t,"instruction"===t){for(i in e)if(e.hasOwnProperty(i))break;s[n.nameKey]="instructionNameFn"in n?n.instructionNameFn(i,e,r):i,n.instructionHasAttributes?(s[n.attributesKey]=e[i][n.attributesKey],"instructionFn"in n&&(s[n.attributesKey]=n.instructionFn(s[n.attributesKey],i,r))):("instructionFn"in n&&(e[i]=n.instructionFn(e[i],i,r)),s[n.instructionKey]=e[i])}else t+"Fn"in n&&(e=n[t+"Fn"](e,r)),s[n[t+"Key"]]=e;n.addParent&&(s[n.parentKey]=r),r[n.elementsKey].push(s)}}function u(t){var e;if("attributesFn"in n&&t&&(t=n.attributesFn(t,r)),(n.trim||"attributeValueFn"in n||"attributeNameFn"in n)&&t)for(e in t)if(t.hasOwnProperty(e)&&(n.trim&&(t[e]=t[e].trim()),"attributeValueFn"in n&&(t[e]=n.attributeValueFn(t[e],e,r)),"attributeNameFn"in n)){var i=t[e];delete t[e],t[n.attributeNameFn(e,t[e],r)]=i}return t}function p(t){var e={};if(t.body&&("xml"===t.name.toLowerCase()||n.instructionHasAttributes)){for(var i,a=/([\w:-]+)\s*=\s*(?:"([^"]*)"|'([^']*)'|(\w+))\s*/g;null!==(i=a.exec(t.body));)e[i[1]]=i[2]||i[3]||i[4];e=u(e)}if("xml"===t.name.toLowerCase()){if(n.ignoreDeclaration)return;r[n.declarationKey]={},Object.keys(e).length&&(r[n.declarationKey][n.attributesKey]=e),n.addParent&&(r[n.declarationKey][n.parentKey]=r)}else{if(n.ignoreInstruction)return;n.trim&&(t.body=t.body.trim());var s={};n.instructionHasAttributes&&Object.keys(e).length?(s[t.name]={},s[t.name][n.attributesKey]=e):s[t.name]=t.body,c("instruction",s)}}function d(t,e){var i;if("object"==typeof t&&(e=t.attributes,t=t.name),e=u(e),"elementNameFn"in n&&(t=n.elementNameFn(t,r)),n.compact){if(i={},!n.ignoreAttributes&&e&&Object.keys(e).length){var a;i[n.attributesKey]={};for(a in e)e.hasOwnProperty(a)&&(i[n.attributesKey][a]=e[a])}t in r||!n.alwaysArray||(r[t]=[]),r[t]&&!l(r[t])&&(r[t]=[r[t]]),l(r[t])?r[t].push(i):r[t]=i}else r[n.elementsKey]||(r[n.elementsKey]=[]),(i={})[n.typeKey]="element",i[n.nameKey]=t,!n.ignoreAttributes&&e&&Object.keys(e).length&&(i[n.attributesKey]=e),n.alwaysChildren&&(i[n.elementsKey]=[]),r[n.elementsKey].push(i);i[n.parentKey]=r,r=i}function m(t){n.ignoreText||(t.trim()||n.captureSpacesBetweenElements)&&(n.trim&&(t=t.trim()),n.nativeType&&(t=function(t){var e=Number(t);if(!isNaN(e))return e;var i=t.toLowerCase();return"true"===i||"false"!==i&&t}(t)),n.sanitize&&(t=t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")),c("text",t))}function y(t){n.ignoreComment||(n.trim&&(t=t.trim()),c("comment",t))}function g(t){var e=r[n.parentKey];n.addParent||delete r[n.parentKey],r=e}function h(t){n.ignoreCdata||(n.trim&&(t=t.trim()),c("cdata",t))}function f(t){n.ignoreDoctype||(t=t.replace(/^ /,""),n.trim&&(t=t.trim()),c("doctype",t))}function T(t){t.note=t}var b=function(t,e){var i,o=a.parser(!0,{}),l={};if(r=l,i=e,n=s.copyOptions(i),s.ensureFlagExists("ignoreDeclaration",n),s.ensureFlagExists("ignoreInstruction",n),s.ensureFlagExists("ignoreAttributes",n),s.ensureFlagExists("ignoreText",n),s.ensureFlagExists("ignoreComment",n),s.ensureFlagExists("ignoreCdata",n),s.ensureFlagExists("ignoreDoctype",n),s.ensureFlagExists("compact",n),s.ensureFlagExists("alwaysArray",n),s.ensureFlagExists("alwaysChildren",n),s.ensureFlagExists("addParent",n),s.ensureFlagExists("trim",n),s.ensureFlagExists("nativeType",n),s.ensureFlagExists("sanitize",n),s.ensureFlagExists("instructionHasAttributes",n),s.ensureFlagExists("captureSpacesBetweenElements",n),s.ensureKeyExists("declaration",n),s.ensureKeyExists("instruction",n),s.ensureKeyExists("attributes",n),s.ensureKeyExists("text",n),s.ensureKeyExists("comment",n),s.ensureKeyExists("cdata",n),s.ensureKeyExists("doctype",n),s.ensureKeyExists("type",n),s.ensureKeyExists("name",n),s.ensureKeyExists("elements",n),s.ensureKeyExists("parent",n),s.checkFnExists("doctype",n),s.checkFnExists("instruction",n),s.checkFnExists("cdata",n),s.checkFnExists("comment",n),s.checkFnExists("text",n),s.checkFnExists("instructionName",n),s.checkFnExists("elementName",n),s.checkFnExists("attributeName",n),s.checkFnExists("attributeValue",n),s.checkFnExists("attributes",n),n=n,o.onopentag=d,o.ontext=m,o.oncomment=y,o.onclosetag=g,o.onerror=T,o.oncdata=h,o.ondoctype=f,o.onprocessinginstruction=p,o.write(t).close(),l[n.elementsKey]){var c=l[n.elementsKey];delete l[n.elementsKey],l[n.elementsKey]=c,delete l.text}return l};var E,v,A,x,_,I,C,w,N,k,S,F=function(t,e){var i,n,r,a,o;return a=e,o=s.copyOptions(a),s.ensureSpacesExists(o),n=b(t,i=o),r="compact"in i&&i.compact?"_parent":"parent",("addParent"in i&&i.addParent?JSON.stringify(n,function(t,e){return t===r?"_":e},i.spaces):JSON.stringify(n,null,i.spaces)).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")};(v=E||(E={})).inline="inline",v.wrapper="wrapper",(x=A||(A={})).cpc="cpc",x.cpm="cpm",x.cpe="cpe",x.cpv="cpv",(_||(_={})).linear="linear",(C=I||(I={})).creativeView="creativeView",C.start="start",C.firstQuartile="firstQuartile",C.midpoint="midpoint",C.thirdQuartile="thirdQuartile",C.complete="complete",C.mute="mute",C.unmute="unmute",C.pause="pause",C.rewind="rewind",C.resume="resume",C.fullscreen="fullscreen",C.exitFullscreen="exitFullscreen",C.expand="expand",C.collapse="collapse",C.acceptInvitation="acceptInvitation",C.close="close",C.skip="skip",C.progress="progress",(N=w||(w={})).IMAGE_GIF="image/gif",N.IMAGE_PNG="image/png",N.IMAGE_JPEG="image/jpeg",N.VIDEO_MP4="video/mp4",(S=k||(k={}))[S.streaming=1]="streaming",S[S.progressive=2]="progressive";var L,D,P,O,M,V,R,B,U,G,K=new(function(){function t(t){t&&(this.xml=t)}return t.prototype.JSON=function(t){if(!t&&!this.xml)throw"XML input is required.";var e=t||this.xml,i=F(e,{compact:!0,spaces:4}),n=JSON.parse(i).VMAP;return{version:this.getVersion(n),breaks:n.AdBreak.map(this.getBreaks.bind(this))}},t.prototype.getVersion=function(t){return t._attributes?t._attributes.version:null},t.prototype.getBreaks=function(t){return{breakTypes:[t._attributes?t._attributes.breakType:null],breakId:t._attributes?t._attributes.breakId:null,timeOffset:t._attributes?t._attributes.timeOffset:null,adSource:{id:t.AdSource._attributes?t.AdSource._attributes.id:null,VASTAdData:this.parseVASTAdDataAds(t.AdSource.VASTAdData.VAST),adDataType:t.AdSource.adDataType,adTagURI:t.AdSource.adTagURL,allowMultipleAds:t.AdSource.allowMultipleAds,dataType:t.AdSource._attributes?t.AdSource._attributes.dataType:null,followRedirects:t.AdSource._attributes?t.AdSource._attributes.followRedirects:null,customAdData:t.AdSource.customAdData},extensions:t.Extensions?this.parseExtensions(t.Extensions.Extension):[],repeatAfter:t._attributes.repeatAfter}},t.prototype.parseVASTAdDataAds=function(t){return{version:t._attributes?t._attributes.version:null,ads:this.parseAd(t.Ad)}},t.prototype.parseAd=function(t){return console.log(t.InLine),[{id:t._attributes.id,adSystem:{version:t.InLine.AdSystem._attributes?t.InLine.AdSystem._attributes.version:null,name:t.InLine.AdSystem._cdata},adTitle:t.InLine.AdTitle._cdata,adType:E.inline,extensions:t.InLine.Extensions.Extension?this.parseExtensions(t.InLine.Extensions.Extension):[],creative:this.parseCreative(t.InLine.Creatives.Creative),error:t.InLine.Error?t.InLine.Error._text:null,sequence:t.InLine.Sequence?t.InLine.Sequence._text:null,description:t.InLine.Description._text,advertiser:t.InLine.Advertiser?t.InLine.Advertiser._text:null,pricing:{value:t.InLine.Pricing._text,currency:t.InLine.Pricing._attributes?t.InLine.Pricing._attributes.currency:null,model:t.InLine.Pricing._attributes?t.InLine.Pricing._attributes.model:null},survey:t.InLine.Survey._text||t.InLine.Survey._cdata,impressions:t.InLine.Impression?this.parseImpression(t.InLine.Impression):[]}]},t.prototype.parseCreative=function(t){var e=this,i=t;Array.isArray(t)||(i=[t]);var n=[];return i.forEach(function(t){var i={id:t._attributes?t._attributes.id:null,adID:t._attributes?t._attributes.AdID:null,sequence:t._attributes?t._attributes.sequence:null,skipoffset:t.Linear._attributes.skipoffset,trackings:e.parseTrackingEvents(t.Linear.TrackingEvents.Tracking),videoClicks:e.parseVideoClicks(t.Linear.VideoClicks),extensions:t.CreativeExtensions,mediaFiles:e.parseMediaFile(t.Linear.MediaFiles.MediaFile),duration:t.Linear.Duration._text,creativeType:_.linear};n.push(i)}),n},t.prototype.parseMediaFile=function(t){var e=t;Array.isArray(t)||(e=[t]);var i=[];return e.forEach(function(t){var e={id:t._attributes?t._attributes.id:null,height:t._attributes?t._attributes.height:null,width:t._attributes?t._attributes.width:null,delivery:t._attributes?t._attributes.delivery:null,codec:t._attributes?t._attributes.codec:null,mimetype:t._attributes?t._attributes.type:null,apiFramework:t._attributes?t._attributes.apiFramework:null,bitrate:t._attributes?t._attributes.bitrate:null,minBitrate:t._attributes?t._attributes.minBitrate:null,maxBitrate:t._attributes?t._attributes.maxBitrate:null,scalable:t._attributes?t._attributes.scalable:null,maintainAspectRatio:t._attributes?t._attributes.maintainAspectRatio:null,uri:t._cdata};i.push(e)}),i},t.prototype.parseTrackingEvents=function(t){var e=t;Array.isArray(t)||(e=[t]);var i=[];return e.forEach(function(t){var e={uri:t._cdata,event:t._attributes?t._attributes.event:null};i.push(e)}),i},t.prototype.parseVideoClicks=function(t){var e={clickTrackings:[],clickThrough:{uri:"",id:""}};if(t.ClickThrough&&(e.clickThrough={uri:t.ClickThrough._cdata,id:t.ClickThrough._attributes?t.ClickThrough._attributes.id:null}),t.clickTrackings){var i=t.clickTrackings;Array.isArray(t.clickTrackings)||(i=[i]),e.clickTrackings=[],i.forEach(function(t){e.clickTrackings&&e.clickTrackings.push({uri:t._cdata,id:t._attributes?t._attributes.id:null})})}if(t.customClicks){var n=t.customClicks;Array.isArray(t.customClicks)||(n=[n]),e.customClicks=[],n.forEach(function(t){e.customClicks&&e.customClicks.push({uri:t._cdata,id:t._attributes?t._attributes.id:null})})}return e},t.prototype.parseExtensions=function(t){var e=t;Array.isArray(t)||(e=[t]);var i=[];return e.forEach(function(t){var e={value:t._text,extensionType:t._attributes?t._attributes.type:null};i.push(e)}),i},t.prototype.parseImpression=function(t){console.log(t._cdata);var e=t;Array.isArray(t)||(e=[t]);var i=[];return e.forEach(function(t){i.push({uri:t._cdata})}),i},t}());(D=L||(L={})).linear="linear",D.nonlinear="nonlinear",D.display="display",(O=P||(P={})).breakStart="breakStart",O.breakEnd="breakEnd",O.error="error",(V=M||(M={})).VAST3="vast3",V.custom="custom",V.adTagURI="adTagURL",(B=R||(R={})).vast1="vast1",B.vast2="vast2",B.proprietary="proprietary",(G=U||(U={})).vast1="vast1",G.vast2="vast2",G.vast3="vast3",G.proprietary="proprietary";var q=function(){function t(t,e,i){this.div=t,this.src=e,this.config=i}return t.prototype.play=function(){console.log("Play image ad",this.div),this.imageWrapper=this.getImageWrapperElement(),this.div.appendChild(this.imageWrapper),console.log(333333)},t.prototype.stop=function(){this.imageWrapper.remove(),this.div.style.position="",this.div.style.top="",this.div.style.bottom="",this.div.style.left="",this.div.style.right="",this.div.style.zIndex=""},t.prototype.getImageWrapperElement=function(){var t=document.createElement("div"),e=document.createElement("img");return e.src=this.src,e.style.width="100%",e.style.height="100%",t.appendChild(e),this.div.style.position="absolute",this.div.style.top="0px",this.div.style.bottom="0px",this.div.style.left="0px",this.div.style.right="0px",this.div.style.zIndex="100",t.id="vmap-image-wrapper",t.style.position="absolute",t.style.top="0px",t.style.bottom="0px",t.style.left="0px",t.style.right="0px",t.style.backgroundColor="#000",t},t}(),H=function(){function t(t,e,i){this.lastSrc="",console.debug("create new instance of video player."),this.div=e,this.player=t,this.src=i}return t.prototype.play=function(){var t=this;console.debug("play ad video player."),this.player.controls(!1);var e=this.getVideoElement();this.lastSrc=e.currentSrc,this.player.pause(),setTimeout(function(){e.setAttribute("src",t.src),e.pause(),console.log(e.getAttribute("src"),{video:e}),e.play()},1)},t.prototype.skip=function(t){console.debug("skip ad video player.",this.lastSrc);var e=this.getVideoElement();e.setAttribute("src",this.lastSrc),this.player.controls(!0),t&&(e.pause(),setTimeout(function(){e.currentTime=.1,e.play()},10))},t.prototype.getVideoElement=function(){return console.log({a:this.div}),(this.div.parentElement||document.createElement("div")).getElementsByTagName("video")[0]},t}(),Y="https://clickyab.com",j="ClickYab",W="حذف آگهی",X="مشاهده آگهی",z="باقیمانده",Q=function(){function t(t,e,i,n,r,a){void 0===a&&(a=!1),this.isMobile=window.navigator.userAgent.match(/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i),this.clickEvent=this.isMobile?"touchstart":"click",this.linkWrapper=!1,console.debug("Create controller overlay instance."),this.div=e,this.player=t,this.title=i,this.src=n,this.skipAfter=r,this.linkWrapper=a}return t.prototype.show=function(){console.debug("Show controller overlay."),this.setTimeLine({position:0,duration:0,type:"start"}),this.overlay=this.getWrapperElement(),this.div.appendChild(this.overlay)},t.prototype.remove=function(){console.debug("Remove controller overlay element."),this.div.setAttribute("style",""),this.div.innerHTML=""},t.prototype.setOnSkip=function(t){this.onSkip=t},t.prototype.setOnEnd=function(t){this.onEnd=t},t.prototype.setOnAdClick=function(t){this.onOpenAdClick=t},t.prototype.getWrapperElement=function(){var t,e=this;return this.linkWrapper?((t=document.createElement("a")).href=this.src,t.target="blank"):t=document.createElement("div"),t.onclick=function(){var t=!1;"function"==typeof e.player.getState&&"playing"===e.player.getState()&&(t=!0),"function"==typeof e.player.played&&e.player.played()&&(t=!0),t?e.player.pause():e.player.play()},this.div.style.position="absolute",this.div.style.top="0px",this.div.style.bottom="0px",this.div.style.left="0px",this.div.style.right="0px",this.div.style.zIndex="100",t.id="vmap-wrapper",t.style.position="absolute",t.style.top="0px",t.style.bottom="0px",t.style.left="0px",t.style.right="0px",t.appendChild(this.getAdLink(this.title)),t.appendChild(this.getFullScreenButton()),t.appendChild(this.getPauseButton()),t.appendChild(this.getProviderClick()),t.appendChild(this.getTimeLineWrapper()),t.appendChild(this.getShadow()),console.log(this.skipAfter),setTimeout(function(){t.appendChild(e.getSkipAd())},1e3*this.skipAfter),t},t.prototype.setTimeLine=function(t){var e=t.position/t.duration*100;this.playerTimeLine&&(this.playerTimeLine.style.width=e+"%");var i=this.formatDuration(t.duration-t.position+1);this.skipCountDown&&(this.skipCountDown.innerHTML=i+" "+z)},t.prototype.getSkipElement=function(){var t=document.createElement("span");return this.skipCountDown=t,this.skipCountDown},t.prototype.getTimeLineElement=function(){var t=document.createElement("div");return t.style.height="4px",t.style.position="absolute",t.style.backgroundColor="rgba(238, 187, 59, 1)",t.style.zIndex="999999",t.style.borderRadius="4px",this.playerTimeLine=t,t},t.prototype.getPauseButton=function(){var t=this,e=document.createElement("div");return e.innerHTML='<svg width="15px" height="16px" viewBox="0 0 15 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n          \x3c!-- Generator: Sketch 44.1 (41455) - http://www.bohemiancoding.com/sketch --\x3e\n          <title>pause</title>\n          <desc>Created with Sketch.</desc>\n          <defs></defs> +\n          <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n              <g id="Artboard" transform="translate(-33.000000, -33.000000)" fill-rule="nonzero" fill="#FAFAFA">\n                  <path d="M33,33 L39,33 L39,49 L33,49 L33,33 Z M41.3266667,33 L47.3266667,33 L47.3266667,49 L41.3266667,49 L41.3266667,33 Z" id="pause"></path>\n              </g>\n          </g>\n      </svg>',e.style.fontSize=(this.isMobile,"13px"),e.style.padding=(this.isMobile,"3px 5px"),e.style.textDecoration="none",e.style.display="block",e.style.position="absolute",e.style.left="10px",e.style.bottom="0px",e.style.textAlign="center",e.style.direction="rtl",e.style.color="rgb(255, 255, 255)",e.style.fontFamily="Tahoma, Arial, Helvetica, sans-serif",e.style.zIndex="214783647",e.style.marginRight="0px",e.style.boxShadow="0px",e.onclick=function(e){e.stopPropagation(),t.player.pause()},e},t.prototype.getFullScreenButton=function(){var t=this,e=document.createElement("div");return e.innerHTML='<svg width="16px" height="16px" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n          \x3c!-- Generator: Sketch 44.1 (41455) - http://www.bohemiancoding.com/sketch --\x3e\n          <title>fullscreen</title>\n          <desc>Created with Sketch.</desc>\n          <defs></defs>\n          <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n              <g id="Artboard" transform="translate(-33.000000, -265.000000)" fill-rule="nonzero" fill="#FAFAFA">\n                  <path d="M33,275.666667 L38.3333333,275.666667 L38.3333333,281 L33,281 L33,275.666667 Z M49,265 L49,281 L41,281 L41,278.333333 L46.3333333,278.333333 L46.3333333,267.666667 L35.6666667,267.666667 L35.6666667,273 L33,273 L33,265 L49,265 Z" id="fullscreen"></path>\n              </g>\n          </g>\n      </svg>',e.style.fontSize=(this.isMobile,"13px"),e.style.padding=(this.isMobile,"3px 5px"),e.style.textDecoration="none",e.style.display="block",e.style.position="absolute",e.style.right="10px",e.style.bottom="0px",e.style.textAlign="center",e.style.direction="rtl",e.style.color="rgb(255, 255, 255)",e.style.fontFamily="Tahoma, Arial, Helvetica, sans-serif",e.style.zIndex="214783647",e.style.marginRight="0px",e.style.boxShadow="0px",e.onclick=function(e){e.stopPropagation(),t.player.setFullscreen(!t.player.getFullscreen())},e},t.prototype.getProviderClick=function(){var t=this,e=document.createElement("div");return e.innerHTML='<a style="position: relative; top: 2px; text-decoration: none" target="_blank" href="'+Y+'" alt="'+j+'">\n      <svg width="14px" height="14px" viewBox="0 0 14 14" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n          <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n              <g id="Artboard" transform="translate(-885.000000, -64.000000)" fill-rule="nonzero" fill="#FFFFFF">\n                  <path d="M892,64 C888.134007,64 885,67.1340068 885,71 C885,74.8659932 888.134007,78 892,78 C895.865993,78 899,74.8659932 899,71 C899,69.1434846 898.262502,67.3630072 896.949747,66.0502525 C895.636993,64.7374979 893.856515,64 892,64 Z M892.875,74.71875 L891.125,74.71875 L891.125,70.34375 L892.875,70.34375 L892.875,74.71875 Z M892.875,69.03125 L891.125,69.03125 L891.125,67.28125 L892.875,67.28125 L892.875,69.03125 Z" id="info"></path>\n              </g>\n          </g>\n      </svg>\n    </a>',e.appendChild(this.getSkipElement()),e.style.fontSize=(this.isMobile,"13px"),e.style.padding=(this.isMobile,"3px 5px"),e.style.textDecoration="none",e.style.display="block",e.style.position="absolute",e.style.right="10px",e.style.bottom="45px",e.style.textAlign="center",e.style.direction="rtl",e.style.color="rgb(255, 255, 255)",e.style.fontFamily="Tahoma, Arial, Helvetica, sans-serif",e.style.zIndex="214783647",e.style.marginRight="0px",e.style.boxShadow="0px",e.style.backgroundColor="rgba(0, 0, 0, 0.7)",e.onclick=function(e){e.stopPropagation(),"playing"===t.player.getState()&&t.player.pause()},e},t.prototype.getAdLink=function(t){var e=this,i=document.createElement("a");return i.href=this.src,i.target="_blank",i.innerHTML='<span style="margin-left: 3px"><svg width="12px" height="12px" viewBox="0 0 12 12" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n          <title>external link</title>\n          <desc>Created with Sketch.</desc>\n          <defs></defs>\n          <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n              <g id="Artboard" transform="translate(-886.000000, -95.000000)" fill-rule="nonzero" fill="#FFFFFF">\n                  <path d="M897.397841,95 C897.704317,95 897.952696,95.2483788 897.952696,95.5548548 L897.952696,99.3770099 C897.952696,99.6834858 897.704317,99.9318646 897.397841,99.9318646 C897.091365,99.9318646 896.842987,99.6834858 896.842987,99.3770099 L896.842987,96.9558497 L891.459403,102.339566 C891.35107,102.447899 891.209025,102.502132 891.067114,102.502132 C890.925202,102.502132 890.783157,102.447899 890.674825,102.339566 C890.458026,102.122901 890.458026,101.77152 890.674825,101.554855 L896.11997,96.1097095 L893.575553,96.1097095 C893.269077,96.1097095 893.020698,95.8613307 893.020698,95.5548548 C893.020698,95.2483788 893.269077,95 893.575553,95 L897.397841,95 Z M895.478636,100.58799 C895.785111,100.58799 896.03349,100.836502 896.03349,101.142844 L896.03349,105.520387 C896.03349,106.33628 895.36977,107 894.553878,107 L887.479613,107 C886.66372,107 886,106.33628 886,105.520387 L886,98.4461224 C886,97.6302301 886.66372,96.9665097 887.479613,96.9665097 L891.872613,96.9665097 C892.179089,96.9665097 892.427467,97.2148885 892.427467,97.5213645 C892.427467,97.8278405 892.179089,98.0762192 891.872613,98.0762192 L887.479613,98.0762192 C887.279071,98.0762192 887.10971,98.2455805 887.10971,98.4461224 L887.10971,105.520387 C887.10971,105.720929 887.279071,105.89029 887.479613,105.89029 L894.553878,105.89029 C894.754419,105.89029 894.923781,105.720929 894.923781,105.520387 L894.923781,101.142844 C894.923781,100.836368 895.17216,100.58799 895.478636,100.58799 Z" id="external-link"></path>\n              </g>\n          </g>\n      </svg></span>'+(t||X),i.style.fontSize=this.isMobile?"13px":"14px",i.style.padding="3px 5px",i.style.textDecoration="none",i.style.display="block",i.style.position="absolute",i.style.right="10px",i.style.bottom="75px",i.style.textAlign="center",i.style.direction="rtl",i.style.color="rgb(255, 255, 255)",i.style.backgroundColor="rgba(0, 0, 0, 0.7)",i.style.fontFamily="Tahoma, Arial, Helvetica, sans-serif",i.style.zIndex="1999999",i.style.cursor="pointer",i.style.marginRight="0px",i.style.boxShadow="0px",i.onclick=function(t){t.stopPropagation(),e.onOpenAdClick&&e.onOpenAdClick()},i},t.prototype.getSkipAd=function(){var t=this,e=document.createElement("div");return e.style.fontSize=(this.isMobile,"13px"),e.style.padding=(this.isMobile,"7px 25px 8px 25px"),e.style.textDecoration="none",e.style.display="block",e.style.position="absolute",e.style.left="-1px",e.style.bottom=(this.isMobile,"50px"),e.style.textAlign="center",e.style.direction="rtl",e.style.color="rgba(255, 255, 255,1)",e.style.backgroundColor="rgba(0, 0, 0, 0.7)",e.style.fontFamily="Tahoma, Arial, Helvetica, sans-serif",e.style.zIndex="1999999",e.style.cursor="pointer",e.style.marginRight="0px",e.style.marginRight="0px",e.style.border="1px solid rgba(255,255,255, 0.20)",e.innerText=W,e.onclick=function(e){e.preventDefault(),console.debug("skip ad."),t.onSkip&&t.onSkip()},e},t.prototype.getTimeLineWrapper=function(){var t=document.createElement("div");return t.style.width="96%",t.style.margin="2%",t.style.bottom="20px",t.style.position="absolute",t.style.height="4px",t.style.borderRadius="4px",t.style.backgroundColor="rgba(255, 255, 255, 0.4)",t.appendChild(this.getTimeLineElement()),t},t.prototype.getShadow=function(){var t=document.createElement("div");return t.setAttribute("class","shadowOverlay"),t.style.position="absolute",t.style.left="0",t.style.width="100%",t.style.height="15%",t.style.bottom="0",t.style.zIndex="999998",t.style.backgroundImage="-moz-linear-gradient(-90deg, rgba(0,0,0,0.00) 0%, #000000 100%)",t.style.backgroundImage="-webkit-linear-gradient(-90deg, rgba(0,0,0,0.00) 0%, #000000 100%)",t.style.backgroundImage="-ms-linear-gradient(-90deg, rgba(0,0,0,0.00) 0%, #000000 100%)",t.style.backgroundImage="-o-linear-gradient(-90deg, rgba(0,0,0,0.00) 0%, #000000 100%)",t.style.backgroundImage="linear-gradient(-90deg, rgba(0,0,0,0.00) 0%, #000000 100%)",t},t.prototype.formatDuration=function(t){var e=parseInt(t.toString(),10).toString(),i=Math.floor(parseInt(e,10)/3600).toString(),n=Math.floor((parseInt(e,10)-3600*parseInt(i,10))/60).toString(),r=(parseInt(e,10)-3600*parseInt(i,10)-60*parseInt(n,10)).toString();return parseInt(i,10)<10&&(i="0"+i),parseInt(n,10)<10&&(n="0"+n),parseInt(r,10)<10&&(r="0"+r),n+":"+r},t}(),J=function(){function t(t,e,i){this.adIsShowing=!1,this.timerLock=0,this.mainVideoEnded=!1,console.debug("Init VideoJs Vast Plugin Class."),this.player=t,this.config=e,this.div=i}return t.prototype.setup=function(){var t=this;console.debug("Setting VideoJs Vast Plugin up."),this.loadVMAP().then(function(e){t.VMAP=e,console.debug("VMAP object is loaded",e),t.player.on("timeupdate",function(){t.timeController()}),t.player.on("play",function(){t.mainVideoEnded&&t.currentAdBreak&&"end"===t.currentAdBreak.timeOffset&&(t.mainVideoEnded=!1,t.adIsShowing=!1,t.showStartLinearAd())})})},t.prototype.timeController=function(){var t={position:this.player.currentTime(),duration:this.player.duration(),type:"time"};this.timerLock!==t.position-t.duration&&(this.timerLock=t.position-t.duration,t.position-t.duration==0?this.onVideoEnd(!1):this.overlayController&&this.overlayController.setTimeLine(t))},t.prototype.onVideoEnd=function(t){var e=this;this.overlayController&&this.overlayController.remove(),this.adIsShowing?(t||this.callCompleteViewApi(),setTimeout(function(){e.adIsShowing=!1},2e3),"start"===this.currentAdBreak.timeOffset?this.videoPlayer?(this.videoPlayer.skip(!0),this.videoPlayer=null):this.imagePlayer&&(this.imagePlayer.stop(),this.imagePlayer=null,setTimeout(function(){e.player.play()},100)):"end"===this.currentAdBreak.timeOffset&&(this.videoPlayer?(this.videoPlayer.skip(!1),this.videoPlayer=null):this.imagePlayer&&(this.imagePlayer.stop(),this.imagePlayer=null))):!1===t&&setTimeout(function(){e.showEndLinerAd()},100)},t.prototype.callCompleteViewApi=function(){var t=this;if(console.debug("Call complete view api"),!this.callCompleteViewApiLock){this.callCompleteViewApiLock=!0,setTimeout(function(){t.callCompleteViewApiLock=!1},2e3);var e=this.currentAdBreak.adSource.VASTAdData.ads[0].creative[0],i=e.trackings.findIndex(function(t){return"complete"===t.event});if(-1!==i&&"video/mp4"===this.currentAdBreak.adSource.VASTAdData.ads[0].creative[0].mediaFiles[0].mimetype){console.debug("Call complete view api with url: ",e.trackings[i].uri);var n=new XMLHttpRequest;n.open("get",e.trackings[i].uri),n.send()}}},t.prototype.callImpressionAdi=function(){var t=this;if(console.debug("Call impression api"),!this.callImpressionViewApiLock){this.callImpressionViewApiLock=!0,setTimeout(function(){t.callImpressionViewApiLock=!1},2e3);var e=this.currentAdBreak.adSource.VASTAdData.ads[0].impressions[0];if(e){console.debug("Call impression api with url: ",e.uri);var i=new XMLHttpRequest;i.open("get",e.uri),i.send()}}},t.prototype.showStartLinearAd=function(){var t=this;console.debug("show start liner ad");var e=!1;this.adIsShowing||(this.adIsShowing=!0,this.player.currentTime()>=.1||this.VMAP.breaks.forEach(function(i){i.breakTypes[0]!==L.linear||"start"!==i.timeOffset||e||(t.showAd(i),e=!0)}))},t.prototype.showEndLinerAd=function(){var t=this;console.debug("show end liner ad");var e=!1;setTimeout(function(){t.mainVideoEnded=!0},1e3),this.adIsShowing||(this.adIsShowing=!0,this.VMAP.breaks.forEach(function(i){i.breakTypes[0]!==L.linear||"end"!==i.timeOffset||e||(t.showAd(i),e=!0)}))},t.prototype.loadVMAP=function(t){return void 0===t&&(t=this.config.requestUrl),console.debug("Try to load VideoJs VMAP from "+t),new Promise(function(e,i){var n=new XMLHttpRequest;n.onreadystatechange=function(){if(4===this.readyState&&200===this.status){var t=K.JSON(n.responseText);console.debug("VMAP loaded:",t),e(t)}},n.onerror=function(){throw i(),new Error("Failed to load VideoJs VMAP from "+t)},n.open("GET",t),n.send()})},t.prototype.showAd=function(t){switch(console.debug("show ad break",t),this.currentAdBreak=t,t.breakTypes[0]){case L.linear:var e=t.adSource.VASTAdData.ads[0].creative[0].mediaFiles[0];switch(e.mimetype){case w.IMAGE_GIF:case w.IMAGE_JPEG:case w.IMAGE_PNG:this.showImagePlayer(t.adSource.VASTAdData.ads[0],t);break;case w.VIDEO_MP4:this.showVideoPlayer(t.adSource.VASTAdData.ads[0],t);break;default:throw new Error('Media file type "'+e.mimetype+'" is not support.')}break;default:throw new Error('AdBreak type "'+this.VMAP.breaks[0].breakTypes[0]+'" is not support.')}},t.prototype.showImagePlayer=function(t,e){var i=this;console.debug("show image player",t,e);var n=t.creative[0].videoClicks.clickThrough.uri,r=e.extensions?e.extensions.findIndex(function(t){return"domain"===t.extensionType}):-1,a=e.extensions?e.extensions.findIndex(function(t){return"skip"===t.extensionType}):-1;this.imagePlayer=new q(this.div,t.creative[0].mediaFiles[0].uri,{}),this.overlayController=new Q(this.player,this.div,r>-1&&e.extensions?e.extensions[r].value.toString():"",n,a>-1&&e.extensions?parseInt(e.extensions[a].value.toString(),10):1e3,!0),this.imagePlayer.play(),this.player.pause();var s=parseInt(t.creative[0].duration.replace(new RegExp(":","g"),""),10),o=0,l=setInterval(function(){if(++o-s>0)return i.imagePlayer&&i.imagePlayer.stop(),i.onVideoEnd(!1),void(o&&clearInterval(l));i.overlayController.setTimeLine({duration:s,position:o,type:"time"})},1e3);this.overlayController.setOnSkip(function(){i.imagePlayer&&i.imagePlayer.stop(),i.onVideoEnd(!0),i.overlayController.remove(),o&&clearInterval(l)}),this.overlayController.show(),this.callImpressionAdi()},t.prototype.showVideoPlayer=function(t,e){var i=this;console.debug("show video ad",t);var n=t.creative[0].videoClicks.clickThrough.uri,r=e.extensions?e.extensions.findIndex(function(t){return"domain"===t.extensionType}):-1,a=e.extensions?e.extensions.findIndex(function(t){return"skip"===t.extensionType}):-1;this.videoPlayer=new H(this.player,this.div,t.creative[0].mediaFiles[0].uri),this.overlayController=new Q(this.player,this.div,r>-1&&e.extensions?e.extensions[r].value.toString():"",n,a>-1&&e.extensions?parseInt(e.extensions[a].value.toString(),10):1e3),this.overlayController.setOnSkip(function(){i.onVideoEnd(!0),i.overlayController.remove()}),this.videoPlayer.play(),this.overlayController.show(),this.callImpressionAdi()},t}();function Z(t){if(videojs){var e=document.createElement("div");(document.getElementById(this.id())||document.createElement("div")).appendChild(e);var i=new J(this,t,e);this.on("ready",function(){i.setup()});var n=!0;this.on("firstplay",function(){n&&(n=!1,i.showStartLinearAd())})}}return videojs&&videojs.plugin("vmap",Z),Z});
//# sourceMappingURL=vmap.js.map
