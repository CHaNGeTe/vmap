import stream from"stream";import string_decoder from"string_decoder";function createCommonjsModule(e,t){return e(t={exports:{}},t.exports),t.exports}var options,currentElement,sax=createCommonjsModule(function(e,t){!function(e){e.parser=function(e,t){return new i(e,t)},e.SAXParser=i,e.SAXStream=o,e.createStream=function(e,t){return new o(e,t)},e.MAX_BUFFER_LENGTH=65536;var t,n=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];function i(t,r){if(!(this instanceof i))return new i(t,r);var o=this;!function(e){for(var t=0,i=n.length;t<i;t++)e[n[t]]=""}(o),o.q=o.c="",o.bufferCheckPosition=e.MAX_BUFFER_LENGTH,o.opt=r||{},o.opt.lowercase=o.opt.lowercase||o.opt.lowercasetags,o.looseCase=o.opt.lowercase?"toLowerCase":"toUpperCase",o.tags=[],o.closed=o.closedRoot=o.sawRoot=!1,o.tag=o.error=null,o.strict=!!t,o.noscript=!(!t&&!o.opt.noscript),o.state=b.BEGIN,o.strictEntities=o.opt.strictEntities,o.ENTITIES=o.strictEntities?Object.create(e.XML_ENTITIES):Object.create(e.ENTITIES),o.attribList=[],o.opt.xmlns&&(o.ns=Object.create(u)),o.trackPosition=!1!==o.opt.position,o.trackPosition&&(o.position=o.line=o.column=0),x(o,"onready")}e.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","opentagstart","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"],Object.create||(Object.create=function(e){function t(){}return t.prototype=e,new t}),Object.keys||(Object.keys=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t}),i.prototype={end:function(){k(this)},write:function(t){var i=this;if(this.error)throw this.error;if(i.closed)return _(i,"Cannot write after close. Assign an onready handler.");if(null===t)return k(i);"object"==typeof t&&(t=t.toString());var r=0,o="";for(;o=M(t,r++),i.c=o,o;)switch(i.trackPosition&&(i.position++,"\n"===o?(i.line++,i.column=0):i.column++),i.state){case b.BEGIN:if(i.state=b.BEGIN_WHITESPACE,"\ufeff"===o)continue;V(i,o);continue;case b.BEGIN_WHITESPACE:V(i,o);continue;case b.TEXT:if(i.sawRoot&&!i.closedRoot){for(var l=r-1;o&&"<"!==o&&"&"!==o;)(o=M(t,r++))&&i.trackPosition&&(i.position++,"\n"===o?(i.line++,i.column=0):i.column++);i.textNode+=t.substring(l,r-1)}"<"!==o||i.sawRoot&&i.closedRoot&&!i.strict?(h(o)||i.sawRoot&&!i.closedRoot||F(i,"Text data outside of root node."),"&"===o?i.state=b.TEXT_ENTITY:i.textNode+=o):(i.state=b.OPEN_WAKA,i.startTagPosition=i.position);continue;case b.SCRIPT:"<"===o?i.state=b.SCRIPT_ENDING:i.script+=o;continue;case b.SCRIPT_ENDING:"/"===o?i.state=b.CLOSE_TAG:(i.script+="<"+o,i.state=b.SCRIPT);continue;case b.OPEN_WAKA:if("!"===o)i.state=b.SGML_DECL,i.sgmlDecl="";else if(h(o));else if(f(p,o))i.state=b.OPEN_TAG,i.tagName=o;else if("/"===o)i.state=b.CLOSE_TAG,i.tagName="";else if("?"===o)i.state=b.PROC_INST,i.procInstName=i.procInstBody="";else{if(F(i,"Unencoded <"),i.startTagPosition+1<i.position){var c=i.position-i.startTagPosition;o=new Array(c).join(" ")+o}i.textNode+="<"+o,i.state=b.TEXT}continue;case b.SGML_DECL:(i.sgmlDecl+o).toUpperCase()===s?(w(i,"onopencdata"),i.state=b.CDATA,i.sgmlDecl="",i.cdata=""):i.sgmlDecl+o==="--"?(i.state=b.COMMENT,i.comment="",i.sgmlDecl=""):(i.sgmlDecl+o).toUpperCase()===a?(i.state=b.DOCTYPE,(i.doctype||i.sawRoot)&&F(i,"Inappropriately located doctype declaration"),i.doctype="",i.sgmlDecl=""):">"===o?(w(i,"onsgmldeclaration",i.sgmlDecl),i.sgmlDecl="",i.state=b.TEXT):g(o)?(i.state=b.SGML_DECL_QUOTED,i.sgmlDecl+=o):i.sgmlDecl+=o;continue;case b.SGML_DECL_QUOTED:o===i.q&&(i.state=b.SGML_DECL,i.q=""),i.sgmlDecl+=o;continue;case b.DOCTYPE:">"===o?(i.state=b.TEXT,w(i,"ondoctype",i.doctype),i.doctype=!0):(i.doctype+=o,"["===o?i.state=b.DOCTYPE_DTD:g(o)&&(i.state=b.DOCTYPE_QUOTED,i.q=o));continue;case b.DOCTYPE_QUOTED:i.doctype+=o,o===i.q&&(i.q="",i.state=b.DOCTYPE);continue;case b.DOCTYPE_DTD:i.doctype+=o,"]"===o?i.state=b.DOCTYPE:g(o)&&(i.state=b.DOCTYPE_DTD_QUOTED,i.q=o);continue;case b.DOCTYPE_DTD_QUOTED:i.doctype+=o,o===i.q&&(i.state=b.DOCTYPE_DTD,i.q="");continue;case b.COMMENT:"-"===o?i.state=b.COMMENT_ENDING:i.comment+=o;continue;case b.COMMENT_ENDING:"-"===o?(i.state=b.COMMENT_ENDED,i.comment=C(i.opt,i.comment),i.comment&&w(i,"oncomment",i.comment),i.comment=""):(i.comment+="-"+o,i.state=b.COMMENT);continue;case b.COMMENT_ENDED:">"!==o?(F(i,"Malformed comment"),i.comment+="--"+o,i.state=b.COMMENT):i.state=b.TEXT;continue;case b.CDATA:"]"===o?i.state=b.CDATA_ENDING:i.cdata+=o;continue;case b.CDATA_ENDING:"]"===o?i.state=b.CDATA_ENDING_2:(i.cdata+="]"+o,i.state=b.CDATA);continue;case b.CDATA_ENDING_2:">"===o?(i.cdata&&w(i,"oncdata",i.cdata),w(i,"onclosecdata"),i.cdata="",i.state=b.TEXT):"]"===o?i.cdata+="]":(i.cdata+="]]"+o,i.state=b.CDATA);continue;case b.PROC_INST:"?"===o?i.state=b.PROC_INST_ENDING:h(o)?i.state=b.PROC_INST_BODY:i.procInstName+=o;continue;case b.PROC_INST_BODY:if(!i.procInstBody&&h(o))continue;"?"===o?i.state=b.PROC_INST_ENDING:i.procInstBody+=o;continue;case b.PROC_INST_ENDING:">"===o?(w(i,"onprocessinginstruction",{name:i.procInstName,body:i.procInstBody}),i.procInstName=i.procInstBody="",i.state=b.TEXT):(i.procInstBody+="?"+o,i.state=b.PROC_INST_BODY);continue;case b.OPEN_TAG:f(d,o)?i.tagName+=o:(N(i),">"===o?D(i):"/"===o?i.state=b.OPEN_TAG_SLASH:(h(o)||F(i,"Invalid character in tag name"),i.state=b.ATTRIB));continue;case b.OPEN_TAG_SLASH:">"===o?(D(i,!0),L(i)):(F(i,"Forward-slash in opening tag not followed by >"),i.state=b.ATTRIB);continue;case b.ATTRIB:if(h(o))continue;">"===o?D(i):"/"===o?i.state=b.OPEN_TAG_SLASH:f(p,o)?(i.attribName=o,i.attribValue="",i.state=b.ATTRIB_NAME):F(i,"Invalid attribute name");continue;case b.ATTRIB_NAME:"="===o?i.state=b.ATTRIB_VALUE:">"===o?(F(i,"Attribute without value"),i.attribValue=i.attribName,S(i),D(i)):h(o)?i.state=b.ATTRIB_NAME_SAW_WHITE:f(d,o)?i.attribName+=o:F(i,"Invalid attribute name");continue;case b.ATTRIB_NAME_SAW_WHITE:if("="===o)i.state=b.ATTRIB_VALUE;else{if(h(o))continue;F(i,"Attribute without value"),i.tag.attributes[i.attribName]="",i.attribValue="",w(i,"onattribute",{name:i.attribName,value:""}),i.attribName="",">"===o?D(i):f(p,o)?(i.attribName=o,i.state=b.ATTRIB_NAME):(F(i,"Invalid attribute name"),i.state=b.ATTRIB)}continue;case b.ATTRIB_VALUE:if(h(o))continue;g(o)?(i.q=o,i.state=b.ATTRIB_VALUE_QUOTED):(F(i,"Unquoted attribute value"),i.state=b.ATTRIB_VALUE_UNQUOTED,i.attribValue=o);continue;case b.ATTRIB_VALUE_QUOTED:if(o!==i.q){"&"===o?i.state=b.ATTRIB_VALUE_ENTITY_Q:i.attribValue+=o;continue}S(i),i.q="",i.state=b.ATTRIB_VALUE_CLOSED;continue;case b.ATTRIB_VALUE_CLOSED:h(o)?i.state=b.ATTRIB:">"===o?D(i):"/"===o?i.state=b.OPEN_TAG_SLASH:f(p,o)?(F(i,"No whitespace between attributes"),i.attribName=o,i.attribValue="",i.state=b.ATTRIB_NAME):F(i,"Invalid attribute name");continue;case b.ATTRIB_VALUE_UNQUOTED:if(">"!==(T=o)&&!h(T)){"&"===o?i.state=b.ATTRIB_VALUE_ENTITY_U:i.attribValue+=o;continue}S(i),">"===o?D(i):i.state=b.ATTRIB;continue;case b.CLOSE_TAG:if(i.tagName)">"===o?L(i):f(d,o)?i.tagName+=o:i.script?(i.script+="</"+i.tagName,i.tagName="",i.state=b.SCRIPT):(h(o)||F(i,"Invalid tagname in closing tag"),i.state=b.CLOSE_TAG_SAW_WHITE);else{if(h(o))continue;f(p,o)?i.tagName=o:i.script?(i.script+="</"+o,i.state=b.SCRIPT):F(i,"Invalid tagname in closing tag.")}continue;case b.CLOSE_TAG_SAW_WHITE:if(h(o))continue;">"===o?L(i):F(i,"Invalid characters in closing tag");continue;case b.TEXT_ENTITY:case b.ATTRIB_VALUE_ENTITY_Q:case b.ATTRIB_VALUE_ENTITY_U:var u,E;switch(i.state){case b.TEXT_ENTITY:u=b.TEXT,E="textNode";break;case b.ATTRIB_VALUE_ENTITY_Q:u=b.ATTRIB_VALUE_QUOTED,E="attribValue";break;case b.ATTRIB_VALUE_ENTITY_U:u=b.ATTRIB_VALUE_UNQUOTED,E="attribValue"}";"===o?(i[E]+=O(i),i.entity="",i.state=u):f(i.entity.length?y:m,o)?i.entity+=o:(F(i,"Invalid character in entity name"),i[E]+="&"+i.entity+o,i.entity="",i.state=u);continue;default:throw new Error(i,"Unknown state: "+i.state)}var T;i.position>=i.bufferCheckPosition&&function(t){for(var i=Math.max(e.MAX_BUFFER_LENGTH,10),r=0,o=0,s=n.length;o<s;o++){var a=t[n[o]].length;if(a>i)switch(n[o]){case"textNode":I(t);break;case"cdata":w(t,"oncdata",t.cdata),t.cdata="";break;case"script":w(t,"onscript",t.script),t.script="";break;default:_(t,"Max buffer length exceeded: "+n[o])}r=Math.max(r,a)}var l=e.MAX_BUFFER_LENGTH-r;t.bufferCheckPosition=l+t.position}(i);return i},resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){var e;I(e=this),""!==e.cdata&&(w(e,"oncdata",e.cdata),e.cdata=""),""!==e.script&&(w(e,"onscript",e.script),e.script="")}};try{t=stream.Stream}catch(e){t=function(){}}var r=e.EVENTS.filter(function(e){return"error"!==e&&"end"!==e});function o(e,n){if(!(this instanceof o))return new o(e,n);t.apply(this),this._parser=new i(e,n),this.writable=!0,this.readable=!0;var s=this;this._parser.onend=function(){s.emit("end")},this._parser.onerror=function(e){s.emit("error",e),s._parser.error=null},this._decoder=null,r.forEach(function(e){Object.defineProperty(s,"on"+e,{get:function(){return s._parser["on"+e]},set:function(t){if(!t)return s.removeAllListeners(e),s._parser["on"+e]=t,t;s.on(e,t)},enumerable:!0,configurable:!1})})}o.prototype=Object.create(t.prototype,{constructor:{value:o}}),o.prototype.write=function(e){if("function"==typeof Buffer&&"function"==typeof Buffer.isBuffer&&Buffer.isBuffer(e)){if(!this._decoder){var t=string_decoder.StringDecoder;this._decoder=new t("utf8")}e=this._decoder.write(e)}return this._parser.write(e.toString()),this.emit("data",e),!0},o.prototype.end=function(e){return e&&e.length&&this.write(e),this._parser.end(),!0},o.prototype.on=function(e,n){var i=this;return i._parser["on"+e]||-1===r.indexOf(e)||(i._parser["on"+e]=function(){var t=1===arguments.length?[arguments[0]]:Array.apply(null,arguments);t.splice(0,0,e),i.emit.apply(i,t)}),t.prototype.on.call(i,e,n)};var s="[CDATA[",a="DOCTYPE",l="http://www.w3.org/XML/1998/namespace",c="http://www.w3.org/2000/xmlns/",u={xml:l,xmlns:c},p=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,d=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/,m=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,y=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/;function h(e){return" "===e||"\n"===e||"\r"===e||"\t"===e}function g(e){return'"'===e||"'"===e}function f(e,t){return e.test(t)}var E,T,v,b=0;e.STATE={BEGIN:b++,BEGIN_WHITESPACE:b++,TEXT:b++,TEXT_ENTITY:b++,OPEN_WAKA:b++,SGML_DECL:b++,SGML_DECL_QUOTED:b++,DOCTYPE:b++,DOCTYPE_QUOTED:b++,DOCTYPE_DTD:b++,DOCTYPE_DTD_QUOTED:b++,COMMENT_STARTING:b++,COMMENT:b++,COMMENT_ENDING:b++,COMMENT_ENDED:b++,CDATA:b++,CDATA_ENDING:b++,CDATA_ENDING_2:b++,PROC_INST:b++,PROC_INST_BODY:b++,PROC_INST_ENDING:b++,OPEN_TAG:b++,OPEN_TAG_SLASH:b++,ATTRIB:b++,ATTRIB_NAME:b++,ATTRIB_NAME_SAW_WHITE:b++,ATTRIB_VALUE:b++,ATTRIB_VALUE_QUOTED:b++,ATTRIB_VALUE_CLOSED:b++,ATTRIB_VALUE_UNQUOTED:b++,ATTRIB_VALUE_ENTITY_Q:b++,ATTRIB_VALUE_ENTITY_U:b++,CLOSE_TAG:b++,CLOSE_TAG_SAW_WHITE:b++,SCRIPT:b++,SCRIPT_ENDING:b++},e.XML_ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'"},e.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,int:8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(e.ENTITIES).forEach(function(t){var n=e.ENTITIES[t],i="number"==typeof n?String.fromCharCode(n):n;e.ENTITIES[t]=i});for(var A in e.STATE)e.STATE[e.STATE[A]]=A;function x(e,t,n){e[t]&&e[t](n)}function w(e,t,n){e.textNode&&I(e),x(e,t,n)}function I(e){e.textNode=C(e.opt,e.textNode),e.textNode&&x(e,"ontext",e.textNode),e.textNode=""}function C(e,t){return e.trim&&(t=t.trim()),e.normalize&&(t=t.replace(/\s+/g," ")),t}function _(e,t){return I(e),e.trackPosition&&(t+="\nLine: "+e.line+"\nColumn: "+e.column+"\nChar: "+e.c),t=new Error(t),e.error=t,x(e,"onerror",t),e}function k(e){return e.sawRoot&&!e.closedRoot&&F(e,"Unclosed root tag"),e.state!==b.BEGIN&&e.state!==b.BEGIN_WHITESPACE&&e.state!==b.TEXT&&_(e,"Unexpected end"),I(e),e.c="",e.closed=!0,x(e,"onend"),i.call(e,e.strict,e.opt),e}function F(e,t){if("object"!=typeof e||!(e instanceof i))throw new Error("bad call to strictFail");e.strict&&_(e,t)}function N(e){e.strict||(e.tagName=e.tagName[e.looseCase]());var t=e.tags[e.tags.length-1]||e,n=e.tag={name:e.tagName,attributes:{}};e.opt.xmlns&&(n.ns=t.ns),e.attribList.length=0,w(e,"onopentagstart",n)}function P(e,t){var n=e.indexOf(":")<0?["",e]:e.split(":"),i=n[0],r=n[1];return t&&"xmlns"===e&&(i="xmlns",r=""),{prefix:i,local:r}}function S(e){if(e.strict||(e.attribName=e.attribName[e.looseCase]()),-1!==e.attribList.indexOf(e.attribName)||e.tag.attributes.hasOwnProperty(e.attribName))e.attribName=e.attribValue="";else{if(e.opt.xmlns){var t=P(e.attribName,!0),n=t.prefix,i=t.local;if("xmlns"===n)if("xml"===i&&e.attribValue!==l)F(e,"xml: prefix must be bound to "+l+"\nActual: "+e.attribValue);else if("xmlns"===i&&e.attribValue!==c)F(e,"xmlns: prefix must be bound to "+c+"\nActual: "+e.attribValue);else{var r=e.tag,o=e.tags[e.tags.length-1]||e;r.ns===o.ns&&(r.ns=Object.create(o.ns)),r.ns[i]=e.attribValue}e.attribList.push([e.attribName,e.attribValue])}else e.tag.attributes[e.attribName]=e.attribValue,w(e,"onattribute",{name:e.attribName,value:e.attribValue});e.attribName=e.attribValue=""}}function D(e,t){if(e.opt.xmlns){var n=e.tag,i=P(e.tagName);n.prefix=i.prefix,n.local=i.local,n.uri=n.ns[i.prefix]||"",n.prefix&&!n.uri&&(F(e,"Unbound namespace prefix: "+JSON.stringify(e.tagName)),n.uri=i.prefix);var r=e.tags[e.tags.length-1]||e;n.ns&&r.ns!==n.ns&&Object.keys(n.ns).forEach(function(t){w(e,"onopennamespace",{prefix:t,uri:n.ns[t]})});for(var o=0,s=e.attribList.length;o<s;o++){var a=e.attribList[o],l=a[0],c=a[1],u=P(l,!0),p=u.prefix,d=u.local,m=""===p?"":n.ns[p]||"",y={name:l,value:c,prefix:p,local:d,uri:m};p&&"xmlns"!==p&&!m&&(F(e,"Unbound namespace prefix: "+JSON.stringify(p)),y.uri=p),e.tag.attributes[l]=y,w(e,"onattribute",y)}e.attribList.length=0}e.tag.isSelfClosing=!!t,e.sawRoot=!0,e.tags.push(e.tag),w(e,"onopentag",e.tag),t||(e.noscript||"script"!==e.tagName.toLowerCase()?e.state=b.TEXT:e.state=b.SCRIPT,e.tag=null,e.tagName=""),e.attribName=e.attribValue="",e.attribList.length=0}function L(e){if(!e.tagName)return F(e,"Weird empty close tag."),e.textNode+="</>",void(e.state=b.TEXT);if(e.script){if("script"!==e.tagName)return e.script+="</"+e.tagName+">",e.tagName="",void(e.state=b.SCRIPT);w(e,"onscript",e.script),e.script=""}var t=e.tags.length,n=e.tagName;e.strict||(n=n[e.looseCase]());for(var i=n;t--;){if(e.tags[t].name===i)break;F(e,"Unexpected close tag")}if(t<0)return F(e,"Unmatched closing tag: "+e.tagName),e.textNode+="</"+e.tagName+">",void(e.state=b.TEXT);e.tagName=n;for(var r=e.tags.length;r-- >t;){var o=e.tag=e.tags.pop();e.tagName=e.tag.name,w(e,"onclosetag",e.tagName);var s={};for(var a in o.ns)s[a]=o.ns[a];var l=e.tags[e.tags.length-1]||e;e.opt.xmlns&&o.ns!==l.ns&&Object.keys(o.ns).forEach(function(t){var n=o.ns[t];w(e,"onclosenamespace",{prefix:t,uri:n})})}0===t&&(e.closedRoot=!0),e.tagName=e.attribValue=e.attribName="",e.attribList.length=0,e.state=b.TEXT}function O(e){var t,n=(e=bc).entity,i=n.toLowerCase(),r="";return e.ENTITIES[n]?e.ENTITIES[n]:e.ENTITIES[i]?e.ENTITIES[i]:("#"===(n=i).charAt(0)&&("x"===n.charAt(1)?(n=n.slice(2),r=(t=parseInt(n,16)).toString(16)):(n=n.slice(1),r=(t=parseInt(n,10)).toString(10))),n=n.replace(/^0+/,""),isNaN(t)||r.toLowerCase()!==n?(F(e,"Invalid character entity"),"&"+e.entity+";"):String.fromCodePoint(t))}function V(e,t){"<"===t?(e.state=b.OPEN_WAKA,e.startTagPosition=e.position):h(t)||(F(e,"Non-whitespace before first tag."),e.textNode=t,e.state=b.TEXT)}function M(e,t){var n="";return t<e.length&&(n=e.charAt(t)),n}b=e.STATE,String.fromCodePoint||(E=String.fromCharCode,T=Math.floor,v=function(){var e,t,n=[],i=-1,r=arguments.length;if(!r)return"";for(var o="";++i<r;){var s=Number(arguments[i]);if(!isFinite(s)||s<0||s>1114111||T(s)!==s)throw RangeError("Invalid code point: "+s);s<=65535?n.push(s):(e=55296+((s-=65536)>>10),t=s%1024+56320,n.push(e,t)),(i+1===r||n.length>16384)&&(o+=E.apply(null,n),n.length=0)}return o},Object.defineProperty?Object.defineProperty(String,"fromCodePoint",{value:v,configurable:!0,writable:!0}):String.fromCodePoint=v)}(t)}),optionsHelper={copyOptions:function(e){var t,n={};for(t in e)e.hasOwnProperty(t)&&(n[t]=e[t]);return n},ensureFlagExists:function(e,t){e in t&&"boolean"==typeof t[e]||(t[e]=!1)},ensureSpacesExists:function(e){"spaces"in e&&("number"==typeof e.spaces||"string"==typeof e.spaces)||(e.spaces=0)},ensureKeyExists:function(e,t){e+"Key"in t&&"string"==typeof t[e+"Key"]||(t[e+"Key"]=t.compact?"_"+e:e)},checkFnExists:function(e,t){return e+"Fn"in t}},arrayHelper={isArray:function(e){return Array.isArray?Array.isArray(e):"[object Array]"===Object.prototype.toString.call(e)}},expat={on:function(){},parse:function(){}},isArray=arrayHelper.isArray,pureJsParser=!0;function validateOptions(e){return options=optionsHelper.copyOptions(e),optionsHelper.ensureFlagExists("ignoreDeclaration",options),optionsHelper.ensureFlagExists("ignoreInstruction",options),optionsHelper.ensureFlagExists("ignoreAttributes",options),optionsHelper.ensureFlagExists("ignoreText",options),optionsHelper.ensureFlagExists("ignoreComment",options),optionsHelper.ensureFlagExists("ignoreCdata",options),optionsHelper.ensureFlagExists("ignoreDoctype",options),optionsHelper.ensureFlagExists("compact",options),optionsHelper.ensureFlagExists("alwaysArray",options),optionsHelper.ensureFlagExists("alwaysChildren",options),optionsHelper.ensureFlagExists("addParent",options),optionsHelper.ensureFlagExists("trim",options),optionsHelper.ensureFlagExists("nativeType",options),optionsHelper.ensureFlagExists("sanitize",options),optionsHelper.ensureFlagExists("instructionHasAttributes",options),optionsHelper.ensureFlagExists("captureSpacesBetweenElements",options),optionsHelper.ensureKeyExists("declaration",options),optionsHelper.ensureKeyExists("instruction",options),optionsHelper.ensureKeyExists("attributes",options),optionsHelper.ensureKeyExists("text",options),optionsHelper.ensureKeyExists("comment",options),optionsHelper.ensureKeyExists("cdata",options),optionsHelper.ensureKeyExists("doctype",options),optionsHelper.ensureKeyExists("type",options),optionsHelper.ensureKeyExists("name",options),optionsHelper.ensureKeyExists("elements",options),optionsHelper.ensureKeyExists("parent",options),optionsHelper.checkFnExists("doctype",options),optionsHelper.checkFnExists("instruction",options),optionsHelper.checkFnExists("cdata",options),optionsHelper.checkFnExists("comment",options),optionsHelper.checkFnExists("text",options),optionsHelper.checkFnExists("instructionName",options),optionsHelper.checkFnExists("elementName",options),optionsHelper.checkFnExists("attributeName",options),optionsHelper.checkFnExists("attributeValue",options),optionsHelper.checkFnExists("attributes",options),options}function nativeType(e){var t=Number(e);if(!isNaN(t))return t;var n=e.toLowerCase();return"true"===n||"false"!==n&&e}function addField(e,t){var n;if(options.compact){if(!currentElement[options[e+"Key"]]&&options.alwaysArray&&(currentElement[options[e+"Key"]]=[]),currentElement[options[e+"Key"]]&&!isArray(currentElement[options[e+"Key"]])&&(currentElement[options[e+"Key"]]=[currentElement[options[e+"Key"]]]),e+"Fn"in options&&"string"==typeof t&&(t=options[e+"Fn"](t,currentElement)),"instruction"===e&&("instructionFn"in options||"instructionNameFn"in options))for(n in t)if(t.hasOwnProperty(n))if("instructionFn"in options)t[n]=options.instructionFn(t[n],n,currentElement);else{var i=t[n];delete t[n],t[options.instructionNameFn(n,i,currentElement)]=i}isArray(currentElement[options[e+"Key"]])?currentElement[options[e+"Key"]].push(t):currentElement[options[e+"Key"]]=t}else{currentElement[options.elementsKey]||(currentElement[options.elementsKey]=[]);var r={};if(r[options.typeKey]=e,"instruction"===e){for(n in t)if(t.hasOwnProperty(n))break;r[options.nameKey]="instructionNameFn"in options?options.instructionNameFn(n,t,currentElement):n,options.instructionHasAttributes?(r[options.attributesKey]=t[n][options.attributesKey],"instructionFn"in options&&(r[options.attributesKey]=options.instructionFn(r[options.attributesKey],n,currentElement))):("instructionFn"in options&&(t[n]=options.instructionFn(t[n],n,currentElement)),r[options.instructionKey]=t[n])}else e+"Fn"in options&&(t=options[e+"Fn"](t,currentElement)),r[options[e+"Key"]]=t;options.addParent&&(r[options.parentKey]=currentElement),currentElement[options.elementsKey].push(r)}}function manipulateAttributes(e){var t;if("attributesFn"in options&&e&&(e=options.attributesFn(e,currentElement)),(options.trim||"attributeValueFn"in options||"attributeNameFn"in options)&&e)for(t in e)if(e.hasOwnProperty(t)&&(options.trim&&(e[t]=e[t].trim()),"attributeValueFn"in options&&(e[t]=options.attributeValueFn(e[t],t,currentElement)),"attributeNameFn"in options)){var n=e[t];delete e[t],e[options.attributeNameFn(t,e[t],currentElement)]=n}return e}function onInstruction(e){var t={};if(e.body&&("xml"===e.name.toLowerCase()||options.instructionHasAttributes)){for(var n,i=/([\w:-]+)\s*=\s*(?:"([^"]*)"|'([^']*)'|(\w+))\s*/g;null!==(n=i.exec(e.body));)t[n[1]]=n[2]||n[3]||n[4];t=manipulateAttributes(t)}if("xml"===e.name.toLowerCase()){if(options.ignoreDeclaration)return;currentElement[options.declarationKey]={},Object.keys(t).length&&(currentElement[options.declarationKey][options.attributesKey]=t),options.addParent&&(currentElement[options.declarationKey][options.parentKey]=currentElement)}else{if(options.ignoreInstruction)return;options.trim&&(e.body=e.body.trim());var r={};options.instructionHasAttributes&&Object.keys(t).length?(r[e.name]={},r[e.name][options.attributesKey]=t):r[e.name]=e.body,addField("instruction",r)}}function onStartElement(e,t){var n;if("object"==typeof e&&(t=e.attributes,e=e.name),t=manipulateAttributes(t),"elementNameFn"in options&&(e=options.elementNameFn(e,currentElement)),options.compact){if(n={},!options.ignoreAttributes&&t&&Object.keys(t).length){var i;n[options.attributesKey]={};for(i in t)t.hasOwnProperty(i)&&(n[options.attributesKey][i]=t[i])}e in currentElement||!options.alwaysArray||(currentElement[e]=[]),currentElement[e]&&!isArray(currentElement[e])&&(currentElement[e]=[currentElement[e]]),isArray(currentElement[e])?currentElement[e].push(n):currentElement[e]=n}else currentElement[options.elementsKey]||(currentElement[options.elementsKey]=[]),(n={})[options.typeKey]="element",n[options.nameKey]=e,!options.ignoreAttributes&&t&&Object.keys(t).length&&(n[options.attributesKey]=t),options.alwaysChildren&&(n[options.elementsKey]=[]),currentElement[options.elementsKey].push(n);n[options.parentKey]=currentElement,currentElement=n}function onText(e){options.ignoreText||(e.trim()||options.captureSpacesBetweenElements)&&(options.trim&&(e=e.trim()),options.nativeType&&(e=nativeType(e)),options.sanitize&&(e=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")),addField("text",e))}function onComment(e){options.ignoreComment||(options.trim&&(e=e.trim()),addField("comment",e))}function onEndElement(e){var t=currentElement[options.parentKey];options.addParent||delete currentElement[options.parentKey],currentElement=t}function onCdata(e){options.ignoreCdata||(options.trim&&(e=e.trim()),addField("cdata",e))}function onDoctype(e){options.ignoreDoctype||(e=e.replace(/^ /,""),options.trim&&(e=e.trim()),addField("doctype",e))}function onError(e){e.note=e}var xml2js=function(e,t){var n=pureJsParser?sax.parser(!0,{}):n=new expat.Parser("UTF-8"),i={};if(currentElement=i,options=validateOptions(t),pureJsParser?(n.onopentag=onStartElement,n.ontext=onText,n.oncomment=onComment,n.onclosetag=onEndElement,n.onerror=onError,n.oncdata=onCdata,n.ondoctype=onDoctype,n.onprocessinginstruction=onInstruction):(n.on("startElement",onStartElement),n.on("text",onText),n.on("comment",onComment),n.on("endElement",onEndElement),n.on("error",onError)),pureJsParser)n.write(e).close();else if(!n.parse(e))throw new Error("XML parsing error: "+n.getError());if(i[options.elementsKey]){var r=i[options.elementsKey];delete i[options.elementsKey],i[options.elementsKey]=r,delete i.text}return i};function validateOptions$1(e){var t=optionsHelper.copyOptions(e);return optionsHelper.ensureSpacesExists(t),t}var currentElement$1,currentElementName,xml2json=function(e,t){var n,i,r;return n=validateOptions$1(t),i=xml2js(e,n),r="compact"in n&&n.compact?"_parent":"parent",("addParent"in n&&n.addParent?JSON.stringify(i,function(e,t){return e===r?"_":t},n.spaces):JSON.stringify(i,null,n.spaces)).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")},isArray$1=arrayHelper.isArray;function validateOptions$2(e){var t=optionsHelper.copyOptions(e);return optionsHelper.ensureFlagExists("ignoreDeclaration",t),optionsHelper.ensureFlagExists("ignoreInstruction",t),optionsHelper.ensureFlagExists("ignoreAttributes",t),optionsHelper.ensureFlagExists("ignoreText",t),optionsHelper.ensureFlagExists("ignoreComment",t),optionsHelper.ensureFlagExists("ignoreCdata",t),optionsHelper.ensureFlagExists("ignoreDoctype",t),optionsHelper.ensureFlagExists("compact",t),optionsHelper.ensureFlagExists("indentText",t),optionsHelper.ensureFlagExists("indentCdata",t),optionsHelper.ensureFlagExists("indentAttributes",t),optionsHelper.ensureFlagExists("indentInstruction",t),optionsHelper.ensureFlagExists("fullTagEmptyElement",t),optionsHelper.ensureFlagExists("noQuotesForNativeAttributes",t),optionsHelper.ensureSpacesExists(t),"number"==typeof t.spaces&&(t.spaces=Array(t.spaces+1).join(" ")),optionsHelper.ensureKeyExists("declaration",t),optionsHelper.ensureKeyExists("instruction",t),optionsHelper.ensureKeyExists("attributes",t),optionsHelper.ensureKeyExists("text",t),optionsHelper.ensureKeyExists("comment",t),optionsHelper.ensureKeyExists("cdata",t),optionsHelper.ensureKeyExists("doctype",t),optionsHelper.ensureKeyExists("type",t),optionsHelper.ensureKeyExists("name",t),optionsHelper.ensureKeyExists("elements",t),optionsHelper.checkFnExists("doctype",t),optionsHelper.checkFnExists("instruction",t),optionsHelper.checkFnExists("cdata",t),optionsHelper.checkFnExists("comment",t),optionsHelper.checkFnExists("text",t),optionsHelper.checkFnExists("instructionName",t),optionsHelper.checkFnExists("elementName",t),optionsHelper.checkFnExists("attributeName",t),optionsHelper.checkFnExists("attributeValue",t),optionsHelper.checkFnExists("attributes",t),optionsHelper.checkFnExists("fullTagEmptyElement",t),t}function writeIndentation(e,t,n){return(!n&&e.spaces?"\n":"")+Array(t+1).join(e.spaces)}function writeAttributes(e,t,n){if(t.ignoreAttributes)return"";"attributesFn"in t&&(e=t.attributesFn(e,currentElementName,currentElement$1));var i,r,o,s,a="";for(i in e)e.hasOwnProperty(i)&&(s=t.noQuotesForNativeAttributes&&"string"!=typeof e[i]?"":'"',r=(r=""+e[i]).replace(/"/g,"&quot;"),o="attributeNameFn"in t?t.attributeNameFn(i,r,currentElementName,currentElement$1):i,a+=t.spaces&&t.indentAttributes?writeIndentation(t,n+1,!1):" ",a+=o+"="+s+("attributeValueFn"in t?t.attributeValueFn(r,i,currentElementName,currentElement$1):r)+s);return e&&Object.keys(e).length&&t.spaces&&t.indentAttributes&&(a+=writeIndentation(t,n,!1)),a}function writeDeclaration(e,t,n){return currentElement$1=e,currentElementName="xml",t.ignoreDeclaration?"":"<?xml"+writeAttributes(e[t.attributesKey],t,n)+"?>"}function writeInstruction(e,t,n){if(t.ignoreInstruction)return"";var i;for(i in e)if(e.hasOwnProperty(i))break;var r="instructionNameFn"in t?t.instructionNameFn(i,e[i],currentElementName,currentElement$1):i;if("object"==typeof e[i])return currentElement$1=e,currentElementName=r,"<?"+r+writeAttributes(e[i][t.attributesKey],t,n)+"?>";var o=e[i]?e[i]:"";return"instructionFn"in t&&(o=t.instructionFn(o,i,currentElementName,currentElement$1)),"<?"+r+(o?" "+o:"")+"?>"}function writeComment(e,t){return t.ignoreComment?"":"\x3c!--"+("commentFn"in t?t.commentFn(e,currentElementName,currentElement$1):e)+"--\x3e"}function writeCdata(e,t){return t.ignoreCdata?"":"<![CDATA["+("cdataFn"in t?t.cdataFn(e,currentElementName,currentElement$1):e)+"]]>"}function writeDoctype(e,t){return t.ignoreDoctype?"":"<!DOCTYPE "+("doctypeFn"in t?t.doctypeFn(e,currentElementName,currentElement$1):e)+">"}function writeText(e,t){return t.ignoreText?"":(e=(e=(e=""+e).replace(/&amp;/g,"&")).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),"textFn"in t?t.textFn(e,currentElementName,currentElement$1):e)}function hasContent(e,t){var n;if(e.elements&&e.elements.length)for(n=0;n<e.elements.length;++n)switch(e.elements[n][t.typeKey]){case"text":if(t.indentText)return!0;break;case"cdata":if(t.indentCdata)return!0;break;case"instruction":if(t.indentInstruction)return!0;break;case"doctype":case"comment":case"element":default:return!0}return!1}function writeElement(e,t,n){currentElement$1=e,currentElementName=e.name;var i="",r="elementNameFn"in t?t.elementNameFn(e.name,e):e.name;i+="<"+r,e[t.attributesKey]&&(i+=writeAttributes(e[t.attributesKey],t,n));var o=e[t.elementsKey]&&e[t.elementsKey].length||e[t.attributesKey]&&"preserve"===e[t.attributesKey]["xml:space"];return o||(o="fullTagEmptyElementFn"in t?t.fullTagEmptyElementFn(e.name,e):t.fullTagEmptyElement),o?(i+=">",e[t.elementsKey]&&e[t.elementsKey].length&&(i+=writeElements(e[t.elementsKey],t,n+1),currentElement$1=e,currentElementName=e.name),i+=t.spaces&&hasContent(e,t)?"\n"+Array(n+1).join(t.spaces):"",i+="</"+r+">"):i+="/>",i}function writeElements(e,t,n,i){return e.reduce(function(e,r){var o=writeIndentation(t,n,i&&!e);switch(r.type){case"element":return e+o+writeElement(r,t,n);case"comment":return e+o+writeComment(r[t.commentKey],t);case"doctype":return e+o+writeDoctype(r[t.doctypeKey],t);case"cdata":return e+(t.indentCdata?o:"")+writeCdata(r[t.cdataKey],t);case"text":return e+(t.indentText?o:"")+writeText(r[t.textKey],t);case"instruction":var s={};return s[r[t.nameKey]]=r[t.attributesKey]?r:r[t.instructionKey],e+(t.indentInstruction?o:"")+writeInstruction(s,t,n)}},"")}function hasContentCompact(e,t,n){var i;for(i in e)if(e.hasOwnProperty(i))switch(i){case t.parentKey:case t.attributesKey:break;case t.textKey:if(t.indentText||n)return!0;break;case t.cdataKey:if(t.indentCdata||n)return!0;break;case t.instructionKey:if(t.indentInstruction||n)return!0;break;case t.doctypeKey:case t.commentKey:default:return!0}return!1}function writeElementCompact(e,t,n,i,r){currentElement$1=e,currentElementName=t;var o="elementNameFn"in n?n.elementNameFn(t,e):t;if(void 0===e||null===e)return"fullTagEmptyElementFn"in n&&n.fullTagEmptyElementFn(t,e)||n.fullTagEmptyElement?"<"+o+"></"+o+">":"<"+o+"/>";var s="";if(t){if(s+="<"+o,"object"!=typeof e)return s+=">"+writeText(e,n)+"</"+o+">";e[n.attributesKey]&&(s+=writeAttributes(e[n.attributesKey],n,i));var a=hasContentCompact(e,n,!0)||e[n.attributesKey]&&"preserve"===e[n.attributesKey]["xml:space"];if(a||(a="fullTagEmptyElementFn"in n?n.fullTagEmptyElementFn(t,e):n.fullTagEmptyElement),!a)return s+="/>";s+=">"}return s+=writeElementsCompact(e,n,i+1,!1),currentElement$1=e,currentElementName=t,t&&(s+=(r?writeIndentation(n,i,!1):"")+"</"+o+">"),s}function writeElementsCompact(e,t,n,i){var r,o,s,a="";for(o in e)if(e.hasOwnProperty(o))for(s=isArray$1(e[o])?e[o]:[e[o]],r=0;r<s.length;++r){switch(o){case t.declarationKey:a+=writeDeclaration(s[r],t,n);break;case t.instructionKey:a+=(t.indentInstruction?writeIndentation(t,n,i):"")+writeInstruction(s[r],t,n);break;case t.attributesKey:case t.parentKey:break;case t.textKey:a+=(t.indentText?writeIndentation(t,n,i):"")+writeText(s[r],t);break;case t.cdataKey:a+=(t.indentCdata?writeIndentation(t,n,i):"")+writeCdata(s[r],t);break;case t.doctypeKey:a+=writeIndentation(t,n,i)+writeDoctype(s[r],t);break;case t.commentKey:a+=writeIndentation(t,n,i)+writeComment(s[r],t);break;default:a+=writeIndentation(t,n,i)+writeElementCompact(s[r],o,t,n,hasContentCompact(s[r],t))}i=i&&!a}return a}var AdType,AdPricingModel,CreativeType,TrackingEventType,mimetype,DeliveryType,js2xml=function(e,t){t=validateOptions$2(t);var n="";return currentElement$1=e,currentElementName="_root_",t.compact?n=writeElementsCompact(e,t,0,!0):(e[t.declarationKey]&&(n+=writeDeclaration(e[t.declarationKey],t,0)),e[t.elementsKey]&&e[t.elementsKey].length&&(n+=writeElements(e[t.elementsKey],t,0,!n))),n},json2xml=function(e,t){e instanceof Buffer&&(e=e.toString());var n=null;if("string"==typeof e)try{n=JSON.parse(e)}catch(e){throw new Error("The JSON structure is invalid")}else n=e;return js2xml(n,t)},lib={xml2js:xml2js,xml2json:xml2json,js2xml:js2xml,json2xml:json2xml};!function(e){e.inline="inline",e.wrapper="wrapper"}(AdType||(AdType={})),function(e){e.cpc="cpc",e.cpm="cpm",e.cpe="cpe",e.cpv="cpv"}(AdPricingModel||(AdPricingModel={})),(CreativeType||(CreativeType={})).linear="linear",function(e){e.creativeView="creativeView",e.start="start",e.firstQuartile="firstQuartile",e.midpoint="midpoint",e.thirdQuartile="thirdQuartile",e.complete="complete",e.mute="mute",e.unmute="unmute",e.pause="pause",e.rewind="rewind",e.resume="resume",e.fullscreen="fullscreen",e.exitFullscreen="exitFullscreen",e.expand="expand",e.collapse="collapse",e.acceptInvitation="acceptInvitation",e.close="close",e.skip="skip",e.progress="progress"}(TrackingEventType||(TrackingEventType={})),function(e){e.IMAGE_GIF="image/gif",e.IMAGE_PNG="image/png",e.IMAGE_JPEG="image/jpeg",e.VIDEO_MP4="video/mp4"}(mimetype||(mimetype={})),function(e){e[e.streaming=1]="streaming",e[e.progressive=2]="progressive"}(DeliveryType||(DeliveryType={}));var AdBreakType,TrackingEvent,AdSourceTypes,customAdSourceTypes,adTagURITypes,VMAPParser=function(){function e(e){e&&(this.xml=e)}return e.prototype.JSON=function(e){if(!e&&!this.xml)throw"XML input is required.";var t=e||this.xml,n=lib.xml2json(t,{compact:!0,spaces:4}),i=JSON.parse(n).VMAP;return{version:this.getVersion(i),breaks:i.AdBreak.map(this.getBreaks.bind(this))}},e.prototype.getVersion=function(e){return e._attributes?e._attributes.version:null},e.prototype.getBreaks=function(e){return{breakTypes:[e._attributes?e._attributes.breakType:null],breakId:e._attributes?e._attributes.breakId:null,timeOffset:e._attributes?e._attributes.timeOffset:null,adSource:{id:e.AdSource._attributes?e.AdSource._attributes.id:null,VASTAdData:this.parseVASTAdDataAds(e.AdSource.VASTAdData.VAST),adDataType:e.AdSource.adDataType,adTagURI:e.AdSource.adTagURL,allowMultipleAds:e.AdSource.allowMultipleAds,dataType:e.AdSource._attributes?e.AdSource._attributes.dataType:null,followRedirects:e.AdSource._attributes?e.AdSource._attributes.followRedirects:null,customAdData:e.AdSource.customAdData},extensions:e.Extensions?this.parseExtensions(e.Extensions.Extension):[],repeatAfter:e._attributes.repeatAfter}},e.prototype.parseVASTAdDataAds=function(e){return{version:e._attributes?e._attributes.version:null,ads:this.parseAd(e.Ad)}},e.prototype.parseAd=function(e){return console.log(e.InLine),[{id:e._attributes.id,adSystem:{version:e.InLine.AdSystem._attributes?e.InLine.AdSystem._attributes.version:null,name:e.InLine.AdSystem._cdata},adTitle:e.InLine.AdTitle._cdata,adType:AdType.inline,extensions:e.InLine.Extensions.Extension?this.parseExtensions(e.InLine.Extensions.Extension):[],creative:this.parseCreative(e.InLine.Creatives.Creative),error:e.InLine.Error?e.InLine.Error._text:null,sequence:e.InLine.Sequence?e.InLine.Sequence._text:null,description:e.InLine.Description._text,advertiser:e.InLine.Advertiser?e.InLine.Advertiser._text:null,pricing:{value:e.InLine.Pricing._text,currency:e.InLine.Pricing._attributes?e.InLine.Pricing._attributes.currency:null,model:e.InLine.Pricing._attributes?e.InLine.Pricing._attributes.model:null},survey:e.InLine.Survey._text||e.InLine.Survey._cdata,impressions:e.InLine.Impression?this.parseImpression(e.InLine.Impression):[]}]},e.prototype.parseCreative=function(e){var t=this,n=e;Array.isArray(e)||(n=[e]);var i=[];return n.forEach(function(e){var n={id:e._attributes?e._attributes.id:null,adID:e._attributes?e._attributes.AdID:null,sequence:e._attributes?e._attributes.sequence:null,skipoffset:e.Linear._attributes.skipoffset,trackings:t.parseTrackingEvents(e.Linear.TrackingEvents.Tracking),videoClicks:t.parseVideoClicks(e.Linear.VideoClicks),extensions:e.CreativeExtensions,mediaFiles:t.parseMediaFile(e.Linear.MediaFiles.MediaFile),duration:e.Linear.Duration._text,creativeType:CreativeType.linear};i.push(n)}),i},e.prototype.parseMediaFile=function(e){var t=e;Array.isArray(e)||(t=[e]);var n=[];return t.forEach(function(e){var t={id:e._attributes?e._attributes.id:null,height:e._attributes?e._attributes.height:null,width:e._attributes?e._attributes.width:null,delivery:e._attributes?e._attributes.delivery:null,codec:e._attributes?e._attributes.codec:null,mimetype:e._attributes?e._attributes.type:null,apiFramework:e._attributes?e._attributes.apiFramework:null,bitrate:e._attributes?e._attributes.bitrate:null,minBitrate:e._attributes?e._attributes.minBitrate:null,maxBitrate:e._attributes?e._attributes.maxBitrate:null,scalable:e._attributes?e._attributes.scalable:null,maintainAspectRatio:e._attributes?e._attributes.maintainAspectRatio:null,uri:e._cdata};n.push(t)}),n},e.prototype.parseTrackingEvents=function(e){var t=e;Array.isArray(e)||(t=[e]);var n=[];return t.forEach(function(e){var t={uri:e._cdata,event:e._attributes?e._attributes.event:null};n.push(t)}),n},e.prototype.parseVideoClicks=function(e){var t={clickTrackings:[],clickThrough:{uri:"",id:""}};if(e.ClickThrough&&(t.clickThrough={uri:e.ClickThrough._cdata,id:e.ClickThrough._attributes?e.ClickThrough._attributes.id:null}),e.clickTrackings){var n=e.clickTrackings;Array.isArray(e.clickTrackings)||(n=[n]),t.clickTrackings=[],n.forEach(function(e){t.clickTrackings&&t.clickTrackings.push({uri:e._cdata,id:e._attributes?e._attributes.id:null})})}if(e.customClicks){var i=e.customClicks;Array.isArray(e.customClicks)||(i=[i]),t.customClicks=[],i.forEach(function(e){t.customClicks&&t.customClicks.push({uri:e._cdata,id:e._attributes?e._attributes.id:null})})}return t},e.prototype.parseExtensions=function(e){var t=e;Array.isArray(e)||(t=[e]);var n=[];return t.forEach(function(e){var t={value:e._text,extensionType:e._attributes?e._attributes.type:null};n.push(t)}),n},e.prototype.parseImpression=function(e){console.log(e._cdata);var t=e;Array.isArray(e)||(t=[e]);var n=[];return t.forEach(function(e){n.push({uri:e._cdata})}),n},e}(),VMAPParser$1=new VMAPParser;!function(e){e.linear="linear",e.nonlinear="nonlinear",e.display="display"}(AdBreakType||(AdBreakType={})),function(e){e.breakStart="breakStart",e.breakEnd="breakEnd",e.error="error"}(TrackingEvent||(TrackingEvent={})),function(e){e.VAST3="vast3",e.custom="custom",e.adTagURI="adTagURL"}(AdSourceTypes||(AdSourceTypes={})),function(e){e.vast1="vast1",e.vast2="vast2",e.proprietary="proprietary"}(customAdSourceTypes||(customAdSourceTypes={})),function(e){e.vast1="vast1",e.vast2="vast2",e.vast3="vast3",e.proprietary="proprietary"}(adTagURITypes||(adTagURITypes={}));var ImagePlayer=function(){function e(e,t,n){this.div=e,this.src=t,this.config=n}return e.prototype.play=function(){console.log("Play image ad",this.div),this.imageWrapper=this.getImageWrapperElement(),this.div.appendChild(this.imageWrapper),console.log(333333)},e.prototype.stop=function(){this.imageWrapper.remove(),this.div.style.position="",this.div.style.top="",this.div.style.bottom="",this.div.style.left="",this.div.style.right="",this.div.style.zIndex=""},e.prototype.getImageWrapperElement=function(){var e=document.createElement("div"),t=document.createElement("img");return t.src=this.src,t.style.width="100%",t.style.height="100%",e.appendChild(t),this.div.style.position="absolute",this.div.style.top="0px",this.div.style.bottom="0px",this.div.style.left="0px",this.div.style.right="0px",this.div.style.zIndex="100",e.id="vmap-image-wrapper",e.style.position="absolute",e.style.top="0px",e.style.bottom="0px",e.style.left="0px",e.style.right="0px",e.style.backgroundColor="#000",e},e}(),VideoPlayer=function(){function e(e,t,n,i){this.lastSrc="",console.debug("create new instance of video player."),this.jwplayer=e,this.div=n,this.player=t,this.src=i}return e.prototype.play=function(){var e=this;console.debug("play ad video player."),this.player.setControls(!1);var t=this.getVideoElement();this.lastSrc=t.currentSrc,this.player.stop(),setTimeout(function(){t.setAttribute("src",e.src),t.pause(),console.log(t.getAttribute("src"),{video:t}),t.play()},1)},e.prototype.skip=function(e){console.debug("skip ad video player.",this.lastSrc);var t=this.getVideoElement();t.setAttribute("src",this.lastSrc),this.player.setControls(!0),e&&(t.pause(),setTimeout(function(){t.currentTime=.1,t.play()},10))},e.prototype.getVideoElement=function(){return this.player.getContainer().getElementsByTagName("video")[0]},e}(),CONFIG={PROVIDE_LINK:"https://clickyab.com",PROVIDE_NAME:"ClickYab",SKIP_TEXT:"حذف آگهی",DEFAULT_SKIP_TIME:7,DEFAULT_AD_TEXT:"مشاهده آگهی",REMAINING_TEXT:"باقیمانده"},Controller=function(){function e(e,t,n,i,r,o){void 0===o&&(o=!1),this.isMobile=window.navigator.userAgent.match(/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i),this.clickEvent=this.isMobile?"touchstart":"click",this.linkWrapper=!1,console.debug("Create controller overlay instance."),this.div=t,this.player=e,this.title=n,this.src=i,this.skipAfter=r,this.linkWrapper=o}return e.prototype.show=function(){console.debug("Show controller overlay."),this.setTimeLine({position:0,duration:0,type:"start"}),this.overlay=this.getWrapperElement(),this.div.appendChild(this.overlay)},e.prototype.remove=function(){console.debug("Remove controller overlay element."),this.div.setAttribute("style",""),this.div.innerHTML=""},e.prototype.setOnSkip=function(e){this.onSkip=e},e.prototype.setOnEnd=function(e){this.onEnd=e},e.prototype.setOnAdClick=function(e){this.onOpenAdClick=e},e.prototype.getWrapperElement=function(){var e,t=this;return this.linkWrapper?((e=document.createElement("a")).href=this.src,e.target="blank"):e=document.createElement("div"),e.onclick=function(){var e=!1;"function"==typeof t.player.getState&&"playing"===t.player.getState()&&(e=!0),"function"==typeof t.player.played&&t.player.played()&&(e=!0),e?t.player.pause():t.player.play()},this.div.style.position="absolute",this.div.style.top="0px",this.div.style.bottom="0px",this.div.style.left="0px",this.div.style.right="0px",this.div.style.zIndex="100",e.id="vmap-wrapper",e.style.position="absolute",e.style.top="0px",e.style.bottom="0px",e.style.left="0px",e.style.right="0px",e.appendChild(this.getAdLink(this.title)),e.appendChild(this.getFullScreenButton()),e.appendChild(this.getPauseButton()),e.appendChild(this.getProviderClick()),e.appendChild(this.getTimeLineWrapper()),e.appendChild(this.getShadow()),console.log(this.skipAfter),setTimeout(function(){e.appendChild(t.getSkipAd())},1e3*this.skipAfter),e},e.prototype.setTimeLine=function(e){var t=e.position/e.duration*100;this.playerTimeLine&&(this.playerTimeLine.style.width=t+"%");var n=this.formatDuration(e.duration-e.position+1);this.skipCountDown&&(this.skipCountDown.innerHTML=n+" "+CONFIG.REMAINING_TEXT)},e.prototype.getSkipElement=function(){var e=document.createElement("span");return this.skipCountDown=e,this.skipCountDown},e.prototype.getTimeLineElement=function(){var e=document.createElement("div");return e.style.height="4px",e.style.position="absolute",e.style.backgroundColor="rgba(238, 187, 59, 1)",e.style.zIndex="999999",e.style.borderRadius="4px",this.playerTimeLine=e,e},e.prototype.getPauseButton=function(){var e=this,t=document.createElement("div");return t.innerHTML='<svg width="15px" height="16px" viewBox="0 0 15 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n          \x3c!-- Generator: Sketch 44.1 (41455) - http://www.bohemiancoding.com/sketch --\x3e\n          <title>pause</title>\n          <desc>Created with Sketch.</desc>\n          <defs></defs> +\n          <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n              <g id="Artboard" transform="translate(-33.000000, -33.000000)" fill-rule="nonzero" fill="#FAFAFA">\n                  <path d="M33,33 L39,33 L39,49 L33,49 L33,33 Z M41.3266667,33 L47.3266667,33 L47.3266667,49 L41.3266667,49 L41.3266667,33 Z" id="pause"></path>\n              </g>\n          </g>\n      </svg>',t.style.fontSize=(this.isMobile,"13px"),t.style.padding=(this.isMobile,"3px 5px"),t.style.textDecoration="none",t.style.display="block",t.style.position="absolute",t.style.left="10px",t.style.bottom="0px",t.style.textAlign="center",t.style.direction="rtl",t.style.color="rgb(255, 255, 255)",t.style.fontFamily="Tahoma, Arial, Helvetica, sans-serif",t.style.zIndex="214783647",t.style.marginRight="0px",t.style.boxShadow="0px",t.onclick=function(t){t.stopPropagation(),e.player.pause()},t},e.prototype.getFullScreenButton=function(){var e=this,t=document.createElement("div");return t.innerHTML='<svg width="16px" height="16px" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n          \x3c!-- Generator: Sketch 44.1 (41455) - http://www.bohemiancoding.com/sketch --\x3e\n          <title>fullscreen</title>\n          <desc>Created with Sketch.</desc>\n          <defs></defs>\n          <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n              <g id="Artboard" transform="translate(-33.000000, -265.000000)" fill-rule="nonzero" fill="#FAFAFA">\n                  <path d="M33,275.666667 L38.3333333,275.666667 L38.3333333,281 L33,281 L33,275.666667 Z M49,265 L49,281 L41,281 L41,278.333333 L46.3333333,278.333333 L46.3333333,267.666667 L35.6666667,267.666667 L35.6666667,273 L33,273 L33,265 L49,265 Z" id="fullscreen"></path>\n              </g>\n          </g>\n      </svg>',t.style.fontSize=(this.isMobile,"13px"),t.style.padding=(this.isMobile,"3px 5px"),t.style.textDecoration="none",t.style.display="block",t.style.position="absolute",t.style.right="10px",t.style.bottom="0px",t.style.textAlign="center",t.style.direction="rtl",t.style.color="rgb(255, 255, 255)",t.style.fontFamily="Tahoma, Arial, Helvetica, sans-serif",t.style.zIndex="214783647",t.style.marginRight="0px",t.style.boxShadow="0px",t.onclick=function(t){t.stopPropagation(),e.player.setFullscreen(!e.player.getFullscreen())},t},e.prototype.getProviderClick=function(){var e=this,t=document.createElement("div");return t.innerHTML='<a style="position: relative; top: 2px; text-decoration: none" target="_blank" href="'+CONFIG.PROVIDE_LINK+'" alt="'+CONFIG.PROVIDE_NAME+'">\n      <svg width="14px" height="14px" viewBox="0 0 14 14" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n          <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n              <g id="Artboard" transform="translate(-885.000000, -64.000000)" fill-rule="nonzero" fill="#FFFFFF">\n                  <path d="M892,64 C888.134007,64 885,67.1340068 885,71 C885,74.8659932 888.134007,78 892,78 C895.865993,78 899,74.8659932 899,71 C899,69.1434846 898.262502,67.3630072 896.949747,66.0502525 C895.636993,64.7374979 893.856515,64 892,64 Z M892.875,74.71875 L891.125,74.71875 L891.125,70.34375 L892.875,70.34375 L892.875,74.71875 Z M892.875,69.03125 L891.125,69.03125 L891.125,67.28125 L892.875,67.28125 L892.875,69.03125 Z" id="info"></path>\n              </g>\n          </g>\n      </svg>\n    </a>',t.appendChild(this.getSkipElement()),t.style.fontSize=(this.isMobile,"13px"),t.style.padding=(this.isMobile,"3px 5px"),t.style.textDecoration="none",t.style.display="block",t.style.position="absolute",t.style.right="10px",t.style.bottom="45px",t.style.textAlign="center",t.style.direction="rtl",t.style.color="rgb(255, 255, 255)",t.style.fontFamily="Tahoma, Arial, Helvetica, sans-serif",t.style.zIndex="214783647",t.style.marginRight="0px",t.style.boxShadow="0px",t.style.backgroundColor="rgba(0, 0, 0, 0.7)",t.onclick=function(t){t.stopPropagation(),"playing"===e.player.getState()&&e.player.pause()},t},e.prototype.getAdLink=function(e){var t=this,n=document.createElement("a");return n.href=this.src,n.target="_blank",n.innerHTML='<span style="margin-left: 3px"><svg width="12px" height="12px" viewBox="0 0 12 12" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n          <title>external link</title>\n          <desc>Created with Sketch.</desc>\n          <defs></defs>\n          <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n              <g id="Artboard" transform="translate(-886.000000, -95.000000)" fill-rule="nonzero" fill="#FFFFFF">\n                  <path d="M897.397841,95 C897.704317,95 897.952696,95.2483788 897.952696,95.5548548 L897.952696,99.3770099 C897.952696,99.6834858 897.704317,99.9318646 897.397841,99.9318646 C897.091365,99.9318646 896.842987,99.6834858 896.842987,99.3770099 L896.842987,96.9558497 L891.459403,102.339566 C891.35107,102.447899 891.209025,102.502132 891.067114,102.502132 C890.925202,102.502132 890.783157,102.447899 890.674825,102.339566 C890.458026,102.122901 890.458026,101.77152 890.674825,101.554855 L896.11997,96.1097095 L893.575553,96.1097095 C893.269077,96.1097095 893.020698,95.8613307 893.020698,95.5548548 C893.020698,95.2483788 893.269077,95 893.575553,95 L897.397841,95 Z M895.478636,100.58799 C895.785111,100.58799 896.03349,100.836502 896.03349,101.142844 L896.03349,105.520387 C896.03349,106.33628 895.36977,107 894.553878,107 L887.479613,107 C886.66372,107 886,106.33628 886,105.520387 L886,98.4461224 C886,97.6302301 886.66372,96.9665097 887.479613,96.9665097 L891.872613,96.9665097 C892.179089,96.9665097 892.427467,97.2148885 892.427467,97.5213645 C892.427467,97.8278405 892.179089,98.0762192 891.872613,98.0762192 L887.479613,98.0762192 C887.279071,98.0762192 887.10971,98.2455805 887.10971,98.4461224 L887.10971,105.520387 C887.10971,105.720929 887.279071,105.89029 887.479613,105.89029 L894.553878,105.89029 C894.754419,105.89029 894.923781,105.720929 894.923781,105.520387 L894.923781,101.142844 C894.923781,100.836368 895.17216,100.58799 895.478636,100.58799 Z" id="external-link"></path>\n              </g>\n          </g>\n      </svg></span>'+(e||CONFIG.DEFAULT_AD_TEXT),n.style.fontSize=this.isMobile?"13px":"14px",n.style.padding="3px 5px",n.style.textDecoration="none",n.style.display="block",n.style.position="absolute",n.style.right="10px",n.style.bottom="75px",n.style.textAlign="center",n.style.direction="rtl",n.style.color="rgb(255, 255, 255)",n.style.backgroundColor="rgba(0, 0, 0, 0.7)",n.style.fontFamily="Tahoma, Arial, Helvetica, sans-serif",n.style.zIndex="1999999",n.style.cursor="pointer",n.style.marginRight="0px",n.style.boxShadow="0px",n.onclick=function(e){e.stopPropagation(),t.onOpenAdClick&&t.onOpenAdClick()},n},e.prototype.getSkipAd=function(){var e=this,t=document.createElement("div");return t.style.fontSize=(this.isMobile,"13px"),t.style.padding=(this.isMobile,"7px 25px 8px 25px"),t.style.textDecoration="none",t.style.display="block",t.style.position="absolute",t.style.left="-1px",t.style.bottom=(this.isMobile,"50px"),t.style.textAlign="center",t.style.direction="rtl",t.style.color="rgba(255, 255, 255,1)",t.style.backgroundColor="rgba(0, 0, 0, 0.7)",t.style.fontFamily="Tahoma, Arial, Helvetica, sans-serif",t.style.zIndex="1999999",t.style.cursor="pointer",t.style.marginRight="0px",t.style.marginRight="0px",t.style.border="1px solid rgba(255,255,255, 0.20)",t.innerText=CONFIG.SKIP_TEXT,t.onclick=function(t){t.preventDefault(),console.debug("skip ad."),e.onSkip&&e.onSkip()},t},e.prototype.getTimeLineWrapper=function(){var e=document.createElement("div");return e.style.width="96%",e.style.margin="2%",e.style.bottom="20px",e.style.position="absolute",e.style.height="4px",e.style.borderRadius="4px",e.style.backgroundColor="rgba(255, 255, 255, 0.4)",e.appendChild(this.getTimeLineElement()),e},e.prototype.getShadow=function(){var e=document.createElement("div");return e.setAttribute("class","shadowOverlay"),e.style.position="absolute",e.style.left="0",e.style.width="100%",e.style.height="15%",e.style.bottom="0",e.style.zIndex="999998",e.style.backgroundImage="-moz-linear-gradient(-90deg, rgba(0,0,0,0.00) 0%, #000000 100%)",e.style.backgroundImage="-webkit-linear-gradient(-90deg, rgba(0,0,0,0.00) 0%, #000000 100%)",e.style.backgroundImage="-ms-linear-gradient(-90deg, rgba(0,0,0,0.00) 0%, #000000 100%)",e.style.backgroundImage="-o-linear-gradient(-90deg, rgba(0,0,0,0.00) 0%, #000000 100%)",e.style.backgroundImage="linear-gradient(-90deg, rgba(0,0,0,0.00) 0%, #000000 100%)",e},e.prototype.formatDuration=function(e){var t=parseInt(e.toString(),10).toString(),n=Math.floor(parseInt(t,10)/3600).toString(),i=Math.floor((parseInt(t,10)-3600*parseInt(n,10))/60).toString(),r=(parseInt(t,10)-3600*parseInt(n,10)-60*parseInt(i,10)).toString();return parseInt(n,10)<10&&(n="0"+n),parseInt(i,10)<10&&(i="0"+i),parseInt(r,10)<10&&(r="0"+r),i+":"+r},e}(),JwPlayerPlugin=function(){function e(e,t,n,i){this.adIsShowing=!1,console.debug("Init JwPlayer Vast Plugin Class."),this.jwPlayerIns=e,this.config=t,this.player=n,this.div=i}return e.prototype.setup=function(){var e=this;console.debug("Setting JwPlayer Vast Plugin up."),this.loadVMAP().then(function(t){e.VMAP=t,console.debug("VMAP object is loaded",t),e.player.onTime(e.timeController.bind(e)),e.player.onComplete(function(){e.onVideoEnd(!1)})})},e.prototype.timeController=function(e){this.overlayController.setTimeLine(e)},e.prototype.onVideoEnd=function(e){var t=this;this.overlayController.remove(),this.adIsShowing?(e||this.callCompleteViewApi(),setTimeout(function(){t.adIsShowing=!1},2e3),"start"===this.currentAdBreak.timeOffset?this.videoPlayer?(this.videoPlayer.skip(!0),this.videoPlayer=null):this.imagePlayer&&(this.player.play(),this.imagePlayer.stop(),this.imagePlayer=null):"end"===this.currentAdBreak.timeOffset&&(this.videoPlayer?(this.videoPlayer.skip(!1),this.videoPlayer=null):this.imagePlayer&&(this.imagePlayer.stop(),this.imagePlayer=null))):!1===e&&this.showEndLinerAd()},e.prototype.callCompleteViewApi=function(){var e=this;if(console.debug("Call complete view api"),!this.callCompleteViewApiLock){this.callCompleteViewApiLock=!0,setTimeout(function(){e.callCompleteViewApiLock=!1},2e3);var t=this.currentAdBreak.adSource.VASTAdData.ads[0].creative[0],n=t.trackings.findIndex(function(e){return"complete"===e.event});if(-1!==n&&"video/mp4"===this.currentAdBreak.adSource.VASTAdData.ads[0].creative[0].mediaFiles[0].mimetype){console.debug("Call complete view api with url: ",t.trackings[n].uri);var i=new XMLHttpRequest;i.open("get",t.trackings[n].uri),i.send()}}},e.prototype.callImpressionAdi=function(){var e=this;if(console.debug("Call impression api"),!this.callImpressionViewApiLock){this.callImpressionViewApiLock=!0,setTimeout(function(){e.callImpressionViewApiLock=!1},2e3);var t=this.currentAdBreak.adSource.VASTAdData.ads[0].impressions[0];if(t){console.debug("Call impression api with url: ",t.uri);var n=new XMLHttpRequest;n.open("get",t.uri),n.send()}}},e.prototype.showStartLinearAd=function(){var e=this;console.debug("show start liner ad");var t=!1;this.adIsShowing||(this.adIsShowing=!0,this.player.getPosition()>=.1||this.VMAP.breaks.forEach(function(n){n.breakTypes[0]!==AdBreakType.linear||"start"!==n.timeOffset||t||(e.showAd(n),t=!0)}))},e.prototype.showEndLinerAd=function(){var e=this,t=!1;this.adIsShowing||(this.adIsShowing=!0,this.VMAP.breaks.forEach(function(n){n.breakTypes[0]!==AdBreakType.linear||"end"!==n.timeOffset||t||(e.showAd(n),t=!0)}))},e.prototype.loadVMAP=function(e){return void 0===e&&(e=this.config.tag),console.debug("Try to load JwPlayer VMAP from "+e),new Promise(function(t,n){var i=new XMLHttpRequest;i.onreadystatechange=function(){if(4===this.readyState&&200===this.status){var e=VMAPParser$1.JSON(i.responseText);console.debug("VMAP loaded:",e),t(e)}},i.onerror=function(t){throw n(),new Error("Failed to load JwPlayer VMAP from "+e)},i.open("GET",e),i.send()})},e.prototype.showAd=function(e){switch(console.debug("show ad break",e),this.currentAdBreak=e,e.breakTypes[0]){case AdBreakType.linear:var t=e.adSource.VASTAdData.ads[0].creative[0].mediaFiles[0];switch(t.mimetype){case mimetype.IMAGE_GIF:case mimetype.IMAGE_JPEG:case mimetype.IMAGE_PNG:this.showImagePlayer(e.adSource.VASTAdData.ads[0],e);break;case mimetype.VIDEO_MP4:this.showVideoPlayer(e.adSource.VASTAdData.ads[0],e);break;default:throw new Error('Media file type "'+t.mimetype+'" is not support.')}break;default:throw new Error('AdBreak type "'+this.VMAP.breaks[0].breakTypes[0]+'" is not support.')}},e.prototype.showImagePlayer=function(e,t){var n=this,i=e.creative[0].videoClicks.clickThrough.uri,r=t.extensions?t.extensions.findIndex(function(e){return"domain"===e.extensionType}):-1,o=t.extensions?t.extensions.findIndex(function(e){return"skip"===e.extensionType}):-1;this.imagePlayer=new ImagePlayer(this.div,e.creative[0].mediaFiles[0].uri,{}),this.imagePlayer.play(),this.player.stop(),this.overlayController=new Controller(this.player,this.div,r>-1&&t.extensions?t.extensions[r].value.toString():"",i,o>-1&&t.extensions?parseInt(t.extensions[o].value.toString(),10):1e3,!0);var s=parseInt(e.creative[0].duration.replace(new RegExp(":","g"),""),10),a=0,l=setInterval(function(){if(++a-s>0)return n.onVideoEnd(!1),void(a&&clearInterval(l));n.overlayController.setTimeLine({duration:s,position:a,type:"time"})},1e3);this.overlayController.setOnSkip(function(){n.onVideoEnd(!0),n.overlayController.remove(),a&&clearInterval(l)}),this.overlayController.show(),this.callImpressionAdi()},e.prototype.showVideoPlayer=function(e,t){var n=this;console.debug("show video ad",e);var i=e.creative[0].videoClicks.clickThrough.uri,r=t.extensions?t.extensions.findIndex(function(e){return"domain"===e.extensionType}):-1,o=t.extensions?t.extensions.findIndex(function(e){return"skip"===e.extensionType}):-1;this.videoPlayer=new VideoPlayer(this.jwPlayerIns,this.player,this.div,e.creative[0].mediaFiles[0].uri),this.overlayController=new Controller(this.player,this.div,r>-1&&t.extensions?t.extensions[r].value.toString():"",i,o>-1&&t.extensions?parseInt(t.extensions[o].value.toString(),10):1e3),this.overlayController.setOnSkip(function(){n.onVideoEnd(!0),n.overlayController.remove()}),this.videoPlayer.play(),this.overlayController.show(),this.callImpressionAdi()},e}();function JwPlayerPluginFn(){if(console.debug("Init JwPlayer Vast Plugin."),jwplayer){jwplayer("").registerPlugin("vmap","6.0",function(e,t,n){var i=e.getConfig(),r=new JwPlayerPlugin(jwplayer,i.advertising,e,n);e.onReady(function(){}),e.onPlay(function(){r.showStartLinearAd()}),e.onPlaylistItem(function(){r.setup()})})}}JwPlayerPluginFn();var VideoPlayer$2=function(){function e(e,t,n){this.lastSrc="",console.debug("create new instance of video player."),this.div=t,this.player=e,this.src=n}return e.prototype.play=function(){var e=this;console.debug("play ad video player."),this.player.controls(!1);var t=this.getVideoElement();this.lastSrc=t.currentSrc,this.player.pause(),setTimeout(function(){t.setAttribute("src",e.src),t.pause(),console.log(t.getAttribute("src"),{video:t}),t.play()},1)},e.prototype.skip=function(e){console.debug("skip ad video player.",this.lastSrc);var t=this.getVideoElement();t.setAttribute("src",this.lastSrc),this.player.controls(!0),e&&(t.pause(),setTimeout(function(){t.currentTime=.1,t.play()},10))},e.prototype.getVideoElement=function(){return console.log({a:this.div}),(this.div.parentElement||document.createElement("div")).getElementsByTagName("video")[0]},e}(),VideoJsPlugin$1=function(){function e(e,t,n){this.adIsShowing=!1,this.timerLock=0,this.mainVideoEnded=!1,console.debug("Init VideoJs Vast Plugin Class."),this.player=e,this.config=t,this.div=n}return e.prototype.setup=function(){var e=this;console.debug("Setting VideoJs Vast Plugin up."),this.loadVMAP().then(function(t){e.VMAP=t,console.debug("VMAP object is loaded",t),e.player.on("timeupdate",function(){e.timeController()}),e.player.on("play",function(){e.mainVideoEnded&&e.currentAdBreak&&"end"===e.currentAdBreak.timeOffset&&(e.mainVideoEnded=!1,e.adIsShowing=!1,e.showStartLinearAd())})})},e.prototype.timeController=function(){var e={position:this.player.currentTime(),duration:this.player.duration(),type:"time"};this.timerLock!==e.position-e.duration&&(this.timerLock=e.position-e.duration,e.position-e.duration==0?this.onVideoEnd(!1):this.overlayController&&this.overlayController.setTimeLine(e))},e.prototype.onVideoEnd=function(e){var t=this;this.overlayController&&this.overlayController.remove(),this.adIsShowing?(e||this.callCompleteViewApi(),setTimeout(function(){t.adIsShowing=!1},2e3),"start"===this.currentAdBreak.timeOffset?this.videoPlayer?(this.videoPlayer.skip(!0),this.videoPlayer=null):this.imagePlayer&&(this.imagePlayer.stop(),this.imagePlayer=null,setTimeout(function(){t.player.play()},100)):"end"===this.currentAdBreak.timeOffset&&(this.videoPlayer?(this.videoPlayer.skip(!1),this.videoPlayer=null):this.imagePlayer&&(this.imagePlayer.stop(),this.imagePlayer=null))):!1===e&&setTimeout(function(){t.showEndLinerAd()},100)},e.prototype.callCompleteViewApi=function(){var e=this;if(console.debug("Call complete view api"),!this.callCompleteViewApiLock){this.callCompleteViewApiLock=!0,setTimeout(function(){e.callCompleteViewApiLock=!1},2e3);var t=this.currentAdBreak.adSource.VASTAdData.ads[0].creative[0],n=t.trackings.findIndex(function(e){return"complete"===e.event});if(-1!==n&&"video/mp4"===this.currentAdBreak.adSource.VASTAdData.ads[0].creative[0].mediaFiles[0].mimetype){console.debug("Call complete view api with url: ",t.trackings[n].uri);var i=new XMLHttpRequest;i.open("get",t.trackings[n].uri),i.send()}}},e.prototype.callImpressionAdi=function(){var e=this;if(console.debug("Call impression api"),!this.callImpressionViewApiLock){this.callImpressionViewApiLock=!0,setTimeout(function(){e.callImpressionViewApiLock=!1},2e3);var t=this.currentAdBreak.adSource.VASTAdData.ads[0].impressions[0];if(t){console.debug("Call impression api with url: ",t.uri);var n=new XMLHttpRequest;n.open("get",t.uri),n.send()}}},e.prototype.showStartLinearAd=function(){var e=this;console.debug("show start liner ad");var t=!1;this.adIsShowing||(this.adIsShowing=!0,this.player.currentTime()>=.1||this.VMAP.breaks.forEach(function(n){n.breakTypes[0]!==AdBreakType.linear||"start"!==n.timeOffset||t||(e.showAd(n),t=!0)}))},e.prototype.showEndLinerAd=function(){var e=this;console.debug("show end liner ad");var t=!1;setTimeout(function(){e.mainVideoEnded=!0},1e3),this.adIsShowing||(this.adIsShowing=!0,this.VMAP.breaks.forEach(function(n){n.breakTypes[0]!==AdBreakType.linear||"end"!==n.timeOffset||t||(e.showAd(n),t=!0)}))},e.prototype.loadVMAP=function(e){return void 0===e&&(e=this.config.requestUrl),console.debug("Try to load VideoJs VMAP from "+e),new Promise(function(t,n){var i=new XMLHttpRequest;i.onreadystatechange=function(){if(4===this.readyState&&200===this.status){var e=VMAPParser$1.JSON(i.responseText);console.debug("VMAP loaded:",e),t(e)}},i.onerror=function(){throw n(),new Error("Failed to load VideoJs VMAP from "+e)},i.open("GET",e),i.send()})},e.prototype.showAd=function(e){switch(console.debug("show ad break",e),this.currentAdBreak=e,e.breakTypes[0]){case AdBreakType.linear:var t=e.adSource.VASTAdData.ads[0].creative[0].mediaFiles[0];switch(t.mimetype){case mimetype.IMAGE_GIF:case mimetype.IMAGE_JPEG:case mimetype.IMAGE_PNG:this.showImagePlayer(e.adSource.VASTAdData.ads[0],e);break;case mimetype.VIDEO_MP4:this.showVideoPlayer(e.adSource.VASTAdData.ads[0],e);break;default:throw new Error('Media file type "'+t.mimetype+'" is not support.')}break;default:throw new Error('AdBreak type "'+this.VMAP.breaks[0].breakTypes[0]+'" is not support.')}},e.prototype.showImagePlayer=function(e,t){var n=this;console.debug("show image player",e,t);var i=e.creative[0].videoClicks.clickThrough.uri,r=t.extensions?t.extensions.findIndex(function(e){return"domain"===e.extensionType}):-1,o=t.extensions?t.extensions.findIndex(function(e){return"skip"===e.extensionType}):-1;this.imagePlayer=new ImagePlayer(this.div,e.creative[0].mediaFiles[0].uri,{}),this.overlayController=new Controller(this.player,this.div,r>-1&&t.extensions?t.extensions[r].value.toString():"",i,o>-1&&t.extensions?parseInt(t.extensions[o].value.toString(),10):1e3,!0),this.imagePlayer.play(),this.player.pause();var s=parseInt(e.creative[0].duration.replace(new RegExp(":","g"),""),10),a=0,l=setInterval(function(){if(++a-s>0)return n.imagePlayer&&n.imagePlayer.stop(),n.onVideoEnd(!1),void(a&&clearInterval(l));n.overlayController.setTimeLine({duration:s,position:a,type:"time"})},1e3);this.overlayController.setOnSkip(function(){n.imagePlayer&&n.imagePlayer.stop(),n.onVideoEnd(!0),n.overlayController.remove(),a&&clearInterval(l)}),this.overlayController.show(),this.callImpressionAdi()},e.prototype.showVideoPlayer=function(e,t){var n=this;console.debug("show video ad",e);var i=e.creative[0].videoClicks.clickThrough.uri,r=t.extensions?t.extensions.findIndex(function(e){return"domain"===e.extensionType}):-1,o=t.extensions?t.extensions.findIndex(function(e){return"skip"===e.extensionType}):-1;this.videoPlayer=new VideoPlayer$2(this.player,this.div,e.creative[0].mediaFiles[0].uri),this.overlayController=new Controller(this.player,this.div,r>-1&&t.extensions?t.extensions[r].value.toString():"",i,o>-1&&t.extensions?parseInt(t.extensions[o].value.toString(),10):1e3),this.overlayController.setOnSkip(function(){n.onVideoEnd(!0),n.overlayController.remove()}),this.videoPlayer.play(),this.overlayController.show(),this.callImpressionAdi()},e}();function VideoJsPlugin(e){if(videojs){var t=document.createElement("div");(document.getElementById(this.id())||document.createElement("div")).appendChild(t);var n=new VideoJsPlugin$1(this,e,t);this.on("ready",function(){n.setup()});var i=!0;this.on("firstplay",function(){i&&(i=!1,n.showStartLinearAd())})}}videojs&&videojs.plugin("vmap",VideoJsPlugin);var index={Parser:VMAPParser,JwPlayer:JwPlayerPluginFn,VideoJs:VideoJsPlugin};export default index;
//# sourceMappingURL=index.js.map
