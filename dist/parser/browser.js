!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("stream"),require("string_decoder")):"function"==typeof define&&define.amd?define(["exports","stream","string_decoder"],e):e(t.parser={},t.stream,t.string_decoder)}(this,function(t,e,a){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e,a=a&&a.hasOwnProperty("default")?a.default:a;var r,n,i,s=(function(t,r){!function(t){t.parser=function(t,e){return new i(t,e)},t.SAXParser=i,t.SAXStream=o,t.createStream=function(t,e){return new o(t,e)},t.MAX_BUFFER_LENGTH=65536;var r,n=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];function i(e,a){if(!(this instanceof i))return new i(e,a);var r=this;!function(t){for(var e=0,a=n.length;e<a;e++)t[n[e]]=""}(r),r.q=r.c="",r.bufferCheckPosition=t.MAX_BUFFER_LENGTH,r.opt=a||{},r.opt.lowercase=r.opt.lowercase||r.opt.lowercasetags,r.looseCase=r.opt.lowercase?"toLowerCase":"toUpperCase",r.tags=[],r.closed=r.closedRoot=r.sawRoot=!1,r.tag=r.error=null,r.strict=!!e,r.noscript=!(!e&&!r.opt.noscript),r.state=I.BEGIN,r.strictEntities=r.opt.strictEntities,r.ENTITIES=r.strictEntities?Object.create(t.XML_ENTITIES):Object.create(t.ENTITIES),r.attribList=[],r.opt.xmlns&&(r.ns=Object.create(m)),r.trackPosition=!1!==r.opt.position,r.trackPosition&&(r.position=r.line=r.column=0),F(r,"onready")}t.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","opentagstart","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"],Object.create||(Object.create=function(t){function e(){}return e.prototype=t,new e}),Object.keys||(Object.keys=function(t){var e=[];for(var a in t)t.hasOwnProperty(a)&&e.push(a);return e}),i.prototype={end:function(){O(this)},write:function(e){var a=this;if(this.error)throw this.error;if(a.closed)return x(a,"Cannot write after close. Assign an onready handler.");if(null===e)return O(a);"object"==typeof e&&(e=e.toString());var r=0,i="";for(;i=M(e,r++),a.c=i,i;)switch(a.trackPosition&&(a.position++,"\n"===i?(a.line++,a.column=0):a.column++),a.state){case I.BEGIN:if(a.state=I.BEGIN_WHITESPACE,"\ufeff"===i)continue;U(a,i);continue;case I.BEGIN_WHITESPACE:U(a,i);continue;case I.TEXT:if(a.sawRoot&&!a.closedRoot){for(var s=r-1;i&&"<"!==i&&"&"!==i;)(i=M(e,r++))&&a.trackPosition&&(a.position++,"\n"===i?(a.line++,a.column=0):a.column++);a.textNode+=e.substring(s,r-1)}"<"!==i||a.sawRoot&&a.closedRoot&&!a.strict?(_(i)||a.sawRoot&&!a.closedRoot||S(a,"Text data outside of root node."),"&"===i?a.state=I.TEXT_ENTITY:a.textNode+=i):(a.state=I.OPEN_WAKA,a.startTagPosition=a.position);continue;case I.SCRIPT:"<"===i?a.state=I.SCRIPT_ENDING:a.script+=i;continue;case I.SCRIPT_ENDING:"/"===i?a.state=I.CLOSE_TAG:(a.script+="<"+i,a.state=I.SCRIPT);continue;case I.OPEN_WAKA:if("!"===i)a.state=I.SGML_DECL,a.sgmlDecl="";else if(_(i));else if(b(d,i))a.state=I.OPEN_TAG,a.tagName=i;else if("/"===i)a.state=I.CLOSE_TAG,a.tagName="";else if("?"===i)a.state=I.PROC_INST,a.procInstName=a.procInstBody="";else{if(S(a,"Unencoded <"),a.startTagPosition+1<a.position){var o=a.position-a.startTagPosition;i=new Array(o).join(" ")+i}a.textNode+="<"+i,a.state=I.TEXT}continue;case I.SGML_DECL:(a.sgmlDecl+i).toUpperCase()===u?(v(a,"onopencdata"),a.state=I.CDATA,a.sgmlDecl="",a.cdata=""):a.sgmlDecl+i==="--"?(a.state=I.COMMENT,a.comment="",a.sgmlDecl=""):(a.sgmlDecl+i).toUpperCase()===c?(a.state=I.DOCTYPE,(a.doctype||a.sawRoot)&&S(a,"Inappropriately located doctype declaration"),a.doctype="",a.sgmlDecl=""):">"===i?(v(a,"onsgmldeclaration",a.sgmlDecl),a.sgmlDecl="",a.state=I.TEXT):g(i)?(a.state=I.SGML_DECL_QUOTED,a.sgmlDecl+=i):a.sgmlDecl+=i;continue;case I.SGML_DECL_QUOTED:i===a.q&&(a.state=I.SGML_DECL,a.q=""),a.sgmlDecl+=i;continue;case I.DOCTYPE:">"===i?(a.state=I.TEXT,v(a,"ondoctype",a.doctype),a.doctype=!0):(a.doctype+=i,"["===i?a.state=I.DOCTYPE_DTD:g(i)&&(a.state=I.DOCTYPE_QUOTED,a.q=i));continue;case I.DOCTYPE_QUOTED:a.doctype+=i,i===a.q&&(a.q="",a.state=I.DOCTYPE);continue;case I.DOCTYPE_DTD:a.doctype+=i,"]"===i?a.state=I.DOCTYPE:g(i)&&(a.state=I.DOCTYPE_DTD_QUOTED,a.q=i);continue;case I.DOCTYPE_DTD_QUOTED:a.doctype+=i,i===a.q&&(a.state=I.DOCTYPE_DTD,a.q="");continue;case I.COMMENT:"-"===i?a.state=I.COMMENT_ENDING:a.comment+=i;continue;case I.COMMENT_ENDING:"-"===i?(a.state=I.COMMENT_ENDED,a.comment=C(a.opt,a.comment),a.comment&&v(a,"oncomment",a.comment),a.comment=""):(a.comment+="-"+i,a.state=I.COMMENT);continue;case I.COMMENT_ENDED:">"!==i?(S(a,"Malformed comment"),a.comment+="--"+i,a.state=I.COMMENT):a.state=I.TEXT;continue;case I.CDATA:"]"===i?a.state=I.CDATA_ENDING:a.cdata+=i;continue;case I.CDATA_ENDING:"]"===i?a.state=I.CDATA_ENDING_2:(a.cdata+="]"+i,a.state=I.CDATA);continue;case I.CDATA_ENDING_2:">"===i?(a.cdata&&v(a,"oncdata",a.cdata),v(a,"onclosecdata"),a.cdata="",a.state=I.TEXT):"]"===i?a.cdata+="]":(a.cdata+="]]"+i,a.state=I.CDATA);continue;case I.PROC_INST:"?"===i?a.state=I.PROC_INST_ENDING:_(i)?a.state=I.PROC_INST_BODY:a.procInstName+=i;continue;case I.PROC_INST_BODY:if(!a.procInstBody&&_(i))continue;"?"===i?a.state=I.PROC_INST_ENDING:a.procInstBody+=i;continue;case I.PROC_INST_ENDING:">"===i?(v(a,"onprocessinginstruction",{name:a.procInstName,body:a.procInstBody}),a.procInstName=a.procInstBody="",a.state=I.TEXT):(a.procInstBody+="?"+i,a.state=I.PROC_INST_BODY);continue;case I.OPEN_TAG:b(T,i)?a.tagName+=i:(L(a),">"===i?k(a):"/"===i?a.state=I.OPEN_TAG_SLASH:(_(i)||S(a,"Invalid character in tag name"),a.state=I.ATTRIB));continue;case I.OPEN_TAG_SLASH:">"===i?(k(a,!0),R(a)):(S(a,"Forward-slash in opening tag not followed by >"),a.state=I.ATTRIB);continue;case I.ATTRIB:if(_(i))continue;">"===i?k(a):"/"===i?a.state=I.OPEN_TAG_SLASH:b(d,i)?(a.attribName=i,a.attribValue="",a.state=I.ATTRIB_NAME):S(a,"Invalid attribute name");continue;case I.ATTRIB_NAME:"="===i?a.state=I.ATTRIB_VALUE:">"===i?(S(a,"Attribute without value"),a.attribValue=a.attribName,w(a),k(a)):_(i)?a.state=I.ATTRIB_NAME_SAW_WHITE:b(T,i)?a.attribName+=i:S(a,"Invalid attribute name");continue;case I.ATTRIB_NAME_SAW_WHITE:if("="===i)a.state=I.ATTRIB_VALUE;else{if(_(i))continue;S(a,"Attribute without value"),a.tag.attributes[a.attribName]="",a.attribValue="",v(a,"onattribute",{name:a.attribName,value:""}),a.attribName="",">"===i?k(a):b(d,i)?(a.attribName=i,a.state=I.ATTRIB_NAME):(S(a,"Invalid attribute name"),a.state=I.ATTRIB)}continue;case I.ATTRIB_VALUE:if(_(i))continue;g(i)?(a.q=i,a.state=I.ATTRIB_VALUE_QUOTED):(S(a,"Unquoted attribute value"),a.state=I.ATTRIB_VALUE_UNQUOTED,a.attribValue=i);continue;case I.ATTRIB_VALUE_QUOTED:if(i!==a.q){"&"===i?a.state=I.ATTRIB_VALUE_ENTITY_Q:a.attribValue+=i;continue}w(a),a.q="",a.state=I.ATTRIB_VALUE_CLOSED;continue;case I.ATTRIB_VALUE_CLOSED:_(i)?a.state=I.ATTRIB:">"===i?k(a):"/"===i?a.state=I.OPEN_TAG_SLASH:b(d,i)?(S(a,"No whitespace between attributes"),a.attribName=i,a.attribValue="",a.state=I.ATTRIB_NAME):S(a,"Invalid attribute name");continue;case I.ATTRIB_VALUE_UNQUOTED:if(">"!==(m=i)&&!_(m)){"&"===i?a.state=I.ATTRIB_VALUE_ENTITY_U:a.attribValue+=i;continue}w(a),">"===i?k(a):a.state=I.ATTRIB;continue;case I.CLOSE_TAG:if(a.tagName)">"===i?R(a):b(T,i)?a.tagName+=i:a.script?(a.script+="</"+a.tagName,a.tagName="",a.state=I.SCRIPT):(_(i)||S(a,"Invalid tagname in closing tag"),a.state=I.CLOSE_TAG_SAW_WHITE);else{if(_(i))continue;b(d,i)?a.tagName=i:a.script?(a.script+="</"+i,a.state=I.SCRIPT):S(a,"Invalid tagname in closing tag.")}continue;case I.CLOSE_TAG_SAW_WHITE:if(_(i))continue;">"===i?R(a):S(a,"Invalid characters in closing tag");continue;case I.TEXT_ENTITY:case I.ATTRIB_VALUE_ENTITY_Q:case I.ATTRIB_VALUE_ENTITY_U:var l,p;switch(a.state){case I.TEXT_ENTITY:l=I.TEXT,p="textNode";break;case I.ATTRIB_VALUE_ENTITY_Q:l=I.ATTRIB_VALUE_QUOTED,p="attribValue";break;case I.ATTRIB_VALUE_ENTITY_U:l=I.ATTRIB_VALUE_UNQUOTED,p="attribValue"}";"===i?(a[p]+=B(a),a.entity="",a.state=l):b(a.entity.length?f:E,i)?a.entity+=i:(S(a,"Invalid character in entity name"),a[p]+="&"+a.entity+i,a.entity="",a.state=l);continue;default:throw new Error(a,"Unknown state: "+a.state)}var m;a.position>=a.bufferCheckPosition&&function(e){for(var a=Math.max(t.MAX_BUFFER_LENGTH,10),r=0,i=0,s=n.length;i<s;i++){var o=e[n[i]].length;if(o>a)switch(n[i]){case"textNode":D(e);break;case"cdata":v(e,"oncdata",e.cdata),e.cdata="";break;case"script":v(e,"onscript",e.script),e.script="";break;default:x(e,"Max buffer length exceeded: "+n[i])}r=Math.max(r,o)}var u=t.MAX_BUFFER_LENGTH-r;e.bufferCheckPosition=u+e.position}(a);return a},resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){var t;D(t=this),""!==t.cdata&&(v(t,"oncdata",t.cdata),t.cdata=""),""!==t.script&&(v(t,"onscript",t.script),t.script="")}};try{r=e.Stream}catch(t){r=function(){}}var s=t.EVENTS.filter(function(t){return"error"!==t&&"end"!==t});function o(t,e){if(!(this instanceof o))return new o(t,e);r.apply(this),this._parser=new i(t,e),this.writable=!0,this.readable=!0;var a=this;this._parser.onend=function(){a.emit("end")},this._parser.onerror=function(t){a.emit("error",t),a._parser.error=null},this._decoder=null,s.forEach(function(t){Object.defineProperty(a,"on"+t,{get:function(){return a._parser["on"+t]},set:function(e){if(!e)return a.removeAllListeners(t),a._parser["on"+t]=e,e;a.on(t,e)},enumerable:!0,configurable:!1})})}o.prototype=Object.create(r.prototype,{constructor:{value:o}}),o.prototype.write=function(t){if("function"==typeof Buffer&&"function"==typeof Buffer.isBuffer&&Buffer.isBuffer(t)){if(!this._decoder){var e=a.StringDecoder;this._decoder=new e("utf8")}t=this._decoder.write(t)}return this._parser.write(t.toString()),this.emit("data",t),!0},o.prototype.end=function(t){return t&&t.length&&this.write(t),this._parser.end(),!0},o.prototype.on=function(t,e){var a=this;return a._parser["on"+t]||-1===s.indexOf(t)||(a._parser["on"+t]=function(){var e=1===arguments.length?[arguments[0]]:Array.apply(null,arguments);e.splice(0,0,t),a.emit.apply(a,e)}),r.prototype.on.call(a,t,e)};var u="[CDATA[",c="DOCTYPE",l="http://www.w3.org/XML/1998/namespace",p="http://www.w3.org/2000/xmlns/",m={xml:l,xmlns:p},d=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,T=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/,E=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,f=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/;function _(t){return" "===t||"\n"===t||"\r"===t||"\t"===t}function g(t){return'"'===t||"'"===t}function b(t,e){return t.test(e)}var A,y,N,I=0;t.STATE={BEGIN:I++,BEGIN_WHITESPACE:I++,TEXT:I++,TEXT_ENTITY:I++,OPEN_WAKA:I++,SGML_DECL:I++,SGML_DECL_QUOTED:I++,DOCTYPE:I++,DOCTYPE_QUOTED:I++,DOCTYPE_DTD:I++,DOCTYPE_DTD_QUOTED:I++,COMMENT_STARTING:I++,COMMENT:I++,COMMENT_ENDING:I++,COMMENT_ENDED:I++,CDATA:I++,CDATA_ENDING:I++,CDATA_ENDING_2:I++,PROC_INST:I++,PROC_INST_BODY:I++,PROC_INST_ENDING:I++,OPEN_TAG:I++,OPEN_TAG_SLASH:I++,ATTRIB:I++,ATTRIB_NAME:I++,ATTRIB_NAME_SAW_WHITE:I++,ATTRIB_VALUE:I++,ATTRIB_VALUE_QUOTED:I++,ATTRIB_VALUE_CLOSED:I++,ATTRIB_VALUE_UNQUOTED:I++,ATTRIB_VALUE_ENTITY_Q:I++,ATTRIB_VALUE_ENTITY_U:I++,CLOSE_TAG:I++,CLOSE_TAG_SAW_WHITE:I++,SCRIPT:I++,SCRIPT_ENDING:I++},t.XML_ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'"},t.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,int:8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(t.ENTITIES).forEach(function(e){var a=t.ENTITIES[e],r="number"==typeof a?String.fromCharCode(a):a;t.ENTITIES[e]=r});for(var h in t.STATE)t.STATE[t.STATE[h]]=h;function F(t,e,a){t[e]&&t[e](a)}function v(t,e,a){t.textNode&&D(t),F(t,e,a)}function D(t){t.textNode=C(t.opt,t.textNode),t.textNode&&F(t,"ontext",t.textNode),t.textNode=""}function C(t,e){return t.trim&&(e=e.trim()),t.normalize&&(e=e.replace(/\s+/g," ")),e}function x(t,e){return D(t),t.trackPosition&&(e+="\nLine: "+t.line+"\nColumn: "+t.column+"\nChar: "+t.c),e=new Error(e),t.error=e,F(t,"onerror",e),t}function O(t){return t.sawRoot&&!t.closedRoot&&S(t,"Unclosed root tag"),t.state!==I.BEGIN&&t.state!==I.BEGIN_WHITESPACE&&t.state!==I.TEXT&&x(t,"Unexpected end"),D(t),t.c="",t.closed=!0,F(t,"onend"),i.call(t,t.strict,t.opt),t}function S(t,e){if("object"!=typeof t||!(t instanceof i))throw new Error("bad call to strictFail");t.strict&&x(t,e)}function L(t){t.strict||(t.tagName=t.tagName[t.looseCase]());var e=t.tags[t.tags.length-1]||t,a=t.tag={name:t.tagName,attributes:{}};t.opt.xmlns&&(a.ns=e.ns),t.attribList.length=0,v(t,"onopentagstart",a)}function P(t,e){var a=t.indexOf(":")<0?["",t]:t.split(":"),r=a[0],n=a[1];return e&&"xmlns"===t&&(r="xmlns",n=""),{prefix:r,local:n}}function w(t){if(t.strict||(t.attribName=t.attribName[t.looseCase]()),-1!==t.attribList.indexOf(t.attribName)||t.tag.attributes.hasOwnProperty(t.attribName))t.attribName=t.attribValue="";else{if(t.opt.xmlns){var e=P(t.attribName,!0),a=e.prefix,r=e.local;if("xmlns"===a)if("xml"===r&&t.attribValue!==l)S(t,"xml: prefix must be bound to "+l+"\nActual: "+t.attribValue);else if("xmlns"===r&&t.attribValue!==p)S(t,"xmlns: prefix must be bound to "+p+"\nActual: "+t.attribValue);else{var n=t.tag,i=t.tags[t.tags.length-1]||t;n.ns===i.ns&&(n.ns=Object.create(i.ns)),n.ns[r]=t.attribValue}t.attribList.push([t.attribName,t.attribValue])}else t.tag.attributes[t.attribName]=t.attribValue,v(t,"onattribute",{name:t.attribName,value:t.attribValue});t.attribName=t.attribValue=""}}function k(t,e){if(t.opt.xmlns){var a=t.tag,r=P(t.tagName);a.prefix=r.prefix,a.local=r.local,a.uri=a.ns[r.prefix]||"",a.prefix&&!a.uri&&(S(t,"Unbound namespace prefix: "+JSON.stringify(t.tagName)),a.uri=r.prefix);var n=t.tags[t.tags.length-1]||t;a.ns&&n.ns!==a.ns&&Object.keys(a.ns).forEach(function(e){v(t,"onopennamespace",{prefix:e,uri:a.ns[e]})});for(var i=0,s=t.attribList.length;i<s;i++){var o=t.attribList[i],u=o[0],c=o[1],l=P(u,!0),p=l.prefix,m=l.local,d=""===p?"":a.ns[p]||"",T={name:u,value:c,prefix:p,local:m,uri:d};p&&"xmlns"!==p&&!d&&(S(t,"Unbound namespace prefix: "+JSON.stringify(p)),T.uri=p),t.tag.attributes[u]=T,v(t,"onattribute",T)}t.attribList.length=0}t.tag.isSelfClosing=!!e,t.sawRoot=!0,t.tags.push(t.tag),v(t,"onopentag",t.tag),e||(t.noscript||"script"!==t.tagName.toLowerCase()?t.state=I.TEXT:t.state=I.SCRIPT,t.tag=null,t.tagName=""),t.attribName=t.attribValue="",t.attribList.length=0}function R(t){if(!t.tagName)return S(t,"Weird empty close tag."),t.textNode+="</>",void(t.state=I.TEXT);if(t.script){if("script"!==t.tagName)return t.script+="</"+t.tagName+">",t.tagName="",void(t.state=I.SCRIPT);v(t,"onscript",t.script),t.script=""}var e=t.tags.length,a=t.tagName;t.strict||(a=a[t.looseCase]());for(var r=a;e--;){if(t.tags[e].name===r)break;S(t,"Unexpected close tag")}if(e<0)return S(t,"Unmatched closing tag: "+t.tagName),t.textNode+="</"+t.tagName+">",void(t.state=I.TEXT);t.tagName=a;for(var n=t.tags.length;n-- >e;){var i=t.tag=t.tags.pop();t.tagName=t.tag.name,v(t,"onclosetag",t.tagName);var s={};for(var o in i.ns)s[o]=i.ns[o];var u=t.tags[t.tags.length-1]||t;t.opt.xmlns&&i.ns!==u.ns&&Object.keys(i.ns).forEach(function(e){var a=i.ns[e];v(t,"onclosenamespace",{prefix:e,uri:a})})}0===e&&(t.closedRoot=!0),t.tagName=t.attribValue=t.attribName="",t.attribList.length=0,t.state=I.TEXT}function B(t){var e,a=(t=dd).entity,r=a.toLowerCase(),n="";return t.ENTITIES[a]?t.ENTITIES[a]:t.ENTITIES[r]?t.ENTITIES[r]:("#"===(a=r).charAt(0)&&("x"===a.charAt(1)?(a=a.slice(2),n=(e=parseInt(a,16)).toString(16)):(a=a.slice(1),n=(e=parseInt(a,10)).toString(10))),a=a.replace(/^0+/,""),isNaN(e)||n.toLowerCase()!==a?(S(t,"Invalid character entity"),"&"+t.entity+";"):String.fromCodePoint(e))}function U(t,e){"<"===e?(t.state=I.OPEN_WAKA,t.startTagPosition=t.position):_(e)||(S(t,"Non-whitespace before first tag."),t.textNode=e,t.state=I.TEXT)}function M(t,e){var a="";return e<t.length&&(a=t.charAt(e)),a}I=t.STATE,String.fromCodePoint||(A=String.fromCharCode,y=Math.floor,N=function(){var t,e,a=[],r=-1,n=arguments.length;if(!n)return"";for(var i="";++r<n;){var s=Number(arguments[r]);if(!isFinite(s)||s<0||s>1114111||y(s)!==s)throw RangeError("Invalid code point: "+s);s<=65535?a.push(s):(t=55296+((s-=65536)>>10),e=s%1024+56320,a.push(t,e)),(r+1===n||a.length>16384)&&(i+=A.apply(null,a),a.length=0)}return i},Object.defineProperty?Object.defineProperty(String,"fromCodePoint",{value:N,configurable:!0,writable:!0}):String.fromCodePoint=N)}(r)}(r={exports:{}},r.exports),r.exports),o={copyOptions:function(t){var e,a={};for(e in t)t.hasOwnProperty(e)&&(a[e]=t[e]);return a},ensureFlagExists:function(t,e){t in e&&"boolean"==typeof e[t]||(e[t]=!1)},ensureSpacesExists:function(t){"spaces"in t&&("number"==typeof t.spaces||"string"==typeof t.spaces)||(t.spaces=0)},ensureKeyExists:function(t,e){t+"Key"in e&&"string"==typeof e[t+"Key"]||(e[t+"Key"]=e.compact?"_"+t:t)},checkFnExists:function(t,e){return t+"Fn"in e}},u=function(t){return Array.isArray?Array.isArray(t):"[object Array]"===Object.prototype.toString.call(t)},c=u;function l(t,e){var a;if(n.compact){if(!i[n[t+"Key"]]&&n.alwaysArray&&(i[n[t+"Key"]]=[]),i[n[t+"Key"]]&&!c(i[n[t+"Key"]])&&(i[n[t+"Key"]]=[i[n[t+"Key"]]]),t+"Fn"in n&&"string"==typeof e&&(e=n[t+"Fn"](e,i)),"instruction"===t&&("instructionFn"in n||"instructionNameFn"in n))for(a in e)if(e.hasOwnProperty(a))if("instructionFn"in n)e[a]=n.instructionFn(e[a],a,i);else{var r=e[a];delete e[a],e[n.instructionNameFn(a,r,i)]=r}c(i[n[t+"Key"]])?i[n[t+"Key"]].push(e):i[n[t+"Key"]]=e}else{i[n.elementsKey]||(i[n.elementsKey]=[]);var s={};if(s[n.typeKey]=t,"instruction"===t){for(a in e)if(e.hasOwnProperty(a))break;s[n.nameKey]="instructionNameFn"in n?n.instructionNameFn(a,e,i):a,n.instructionHasAttributes?(s[n.attributesKey]=e[a][n.attributesKey],"instructionFn"in n&&(s[n.attributesKey]=n.instructionFn(s[n.attributesKey],a,i))):("instructionFn"in n&&(e[a]=n.instructionFn(e[a],a,i)),s[n.instructionKey]=e[a])}else t+"Fn"in n&&(e=n[t+"Fn"](e,i)),s[n[t+"Key"]]=e;n.addParent&&(s[n.parentKey]=i),i[n.elementsKey].push(s)}}function p(t){var e;if("attributesFn"in n&&t&&(t=n.attributesFn(t,i)),(n.trim||"attributeValueFn"in n||"attributeNameFn"in n)&&t)for(e in t)if(t.hasOwnProperty(e)&&(n.trim&&(t[e]=t[e].trim()),"attributeValueFn"in n&&(t[e]=n.attributeValueFn(t[e],e,i)),"attributeNameFn"in n)){var a=t[e];delete t[e],t[n.attributeNameFn(e,t[e],i)]=a}return t}function m(t){var e={};if(t.body&&("xml"===t.name.toLowerCase()||n.instructionHasAttributes)){for(var a,r=/([\w:-]+)\s*=\s*(?:"([^"]*)"|'([^']*)'|(\w+))\s*/g;null!==(a=r.exec(t.body));)e[a[1]]=a[2]||a[3]||a[4];e=p(e)}if("xml"===t.name.toLowerCase()){if(n.ignoreDeclaration)return;i[n.declarationKey]={},Object.keys(e).length&&(i[n.declarationKey][n.attributesKey]=e),n.addParent&&(i[n.declarationKey][n.parentKey]=i)}else{if(n.ignoreInstruction)return;n.trim&&(t.body=t.body.trim());var s={};n.instructionHasAttributes&&Object.keys(e).length?(s[t.name]={},s[t.name][n.attributesKey]=e):s[t.name]=t.body,l("instruction",s)}}function d(t,e){var a;if("object"==typeof t&&(e=t.attributes,t=t.name),e=p(e),"elementNameFn"in n&&(t=n.elementNameFn(t,i)),n.compact){if(a={},!n.ignoreAttributes&&e&&Object.keys(e).length){var r;a[n.attributesKey]={};for(r in e)e.hasOwnProperty(r)&&(a[n.attributesKey][r]=e[r])}t in i||!n.alwaysArray||(i[t]=[]),i[t]&&!c(i[t])&&(i[t]=[i[t]]),c(i[t])?i[t].push(a):i[t]=a}else i[n.elementsKey]||(i[n.elementsKey]=[]),(a={})[n.typeKey]="element",a[n.nameKey]=t,!n.ignoreAttributes&&e&&Object.keys(e).length&&(a[n.attributesKey]=e),n.alwaysChildren&&(a[n.elementsKey]=[]),i[n.elementsKey].push(a);a[n.parentKey]=i,i=a}function T(t){n.ignoreText||(t.trim()||n.captureSpacesBetweenElements)&&(n.trim&&(t=t.trim()),n.nativeType&&(t=function(t){var e=Number(t);if(!isNaN(e))return e;var a=t.toLowerCase();return"true"===a||"false"!==a&&t}(t)),n.sanitize&&(t=t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")),l("text",t))}function E(t){n.ignoreComment||(n.trim&&(t=t.trim()),l("comment",t))}function f(t){var e=i[n.parentKey];n.addParent||delete i[n.parentKey],i=e}function _(t){n.ignoreCdata||(n.trim&&(t=t.trim()),l("cdata",t))}function g(t){n.ignoreDoctype||(t=t.replace(/^ /,""),n.trim&&(t=t.trim()),l("doctype",t))}function b(t){t.note=t}var A=function(t,e){var a,r=s.parser(!0,{}),u={};if(i=u,a=e,n=o.copyOptions(a),o.ensureFlagExists("ignoreDeclaration",n),o.ensureFlagExists("ignoreInstruction",n),o.ensureFlagExists("ignoreAttributes",n),o.ensureFlagExists("ignoreText",n),o.ensureFlagExists("ignoreComment",n),o.ensureFlagExists("ignoreCdata",n),o.ensureFlagExists("ignoreDoctype",n),o.ensureFlagExists("compact",n),o.ensureFlagExists("alwaysArray",n),o.ensureFlagExists("alwaysChildren",n),o.ensureFlagExists("addParent",n),o.ensureFlagExists("trim",n),o.ensureFlagExists("nativeType",n),o.ensureFlagExists("sanitize",n),o.ensureFlagExists("instructionHasAttributes",n),o.ensureFlagExists("captureSpacesBetweenElements",n),o.ensureKeyExists("declaration",n),o.ensureKeyExists("instruction",n),o.ensureKeyExists("attributes",n),o.ensureKeyExists("text",n),o.ensureKeyExists("comment",n),o.ensureKeyExists("cdata",n),o.ensureKeyExists("doctype",n),o.ensureKeyExists("type",n),o.ensureKeyExists("name",n),o.ensureKeyExists("elements",n),o.ensureKeyExists("parent",n),o.checkFnExists("doctype",n),o.checkFnExists("instruction",n),o.checkFnExists("cdata",n),o.checkFnExists("comment",n),o.checkFnExists("text",n),o.checkFnExists("instructionName",n),o.checkFnExists("elementName",n),o.checkFnExists("attributeName",n),o.checkFnExists("attributeValue",n),o.checkFnExists("attributes",n),n=n,r.onopentag=d,r.ontext=T,r.oncomment=E,r.onclosetag=f,r.onerror=b,r.oncdata=_,r.ondoctype=g,r.onprocessinginstruction=m,r.write(t).close(),u[n.elementsKey]){var c=u[n.elementsKey];delete u[n.elementsKey],u[n.elementsKey]=c,delete u.text}return u};var y,N,I,h,F,v,D,C,x,O,S,L=function(t,e){var a,r,n,i,s;return i=e,s=o.copyOptions(i),o.ensureSpacesExists(s),r=A(t,a=s),n="compact"in a&&a.compact?"_parent":"parent",("addParent"in a&&a.addParent?JSON.stringify(r,function(t,e){return t===n?"_":e},a.spaces):JSON.stringify(r,null,a.spaces)).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")};(N=y||(y={})).inline="inline",N.wrapper="wrapper",(h=I||(I={})).cpc="cpc",h.cpm="cpm",h.cpe="cpe",h.cpv="cpv",(F||(F={})).linear="linear",(D=v||(v={})).creativeView="creativeView",D.start="start",D.firstQuartile="firstQuartile",D.midpoint="midpoint",D.thirdQuartile="thirdQuartile",D.complete="complete",D.mute="mute",D.unmute="unmute",D.pause="pause",D.rewind="rewind",D.resume="resume",D.fullscreen="fullscreen",D.exitFullscreen="exitFullscreen",D.expand="expand",D.collapse="collapse",D.acceptInvitation="acceptInvitation",D.close="close",D.skip="skip",D.progress="progress",(x=C||(C={})).IMAGE_GIF="image/gif",x.IMAGE_PNG="image/png",x.IMAGE_JPEG="image/jpeg",x.VIDEO_MP4="video/mp4",(S=O||(O={}))[S.streaming=1]="streaming",S[S.progressive=2]="progressive";var P=function(){function t(t){t&&(this.xml=t)}return t.prototype.JSON=function(t){if(!t&&!this.xml)throw"XML input is required.";var e=t||this.xml,a=L(e,{compact:!0,spaces:4}),r=JSON.parse(a).VMAP;return{version:this.getVersion(r),breaks:r.AdBreak.map(this.getBreaks.bind(this))}},t.prototype.getVersion=function(t){return t._attributes?t._attributes.version:null},t.prototype.getBreaks=function(t){return{breakTypes:[t._attributes?t._attributes.breakType:null],breakId:t._attributes?t._attributes.breakId:null,timeOffset:t._attributes?t._attributes.timeOffset:null,adSource:{id:t.AdSource._attributes?t.AdSource._attributes.id:null,VASTAdData:this.parseVASTAdDataAds(t.AdSource.VASTAdData.VAST),adDataType:t.AdSource.adDataType,adTagURI:t.AdSource.adTagURL,allowMultipleAds:t.AdSource.allowMultipleAds,dataType:t.AdSource._attributes?t.AdSource._attributes.dataType:null,followRedirects:t.AdSource._attributes?t.AdSource._attributes.followRedirects:null,customAdData:t.AdSource.customAdData},extensions:t.Extensions?this.parseExtensions(t.Extensions.Extension):[],repeatAfter:t._attributes.repeatAfter}},t.prototype.parseVASTAdDataAds=function(t){return{version:t._attributes?t._attributes.version:null,ads:this.parseAd(t.Ad)}},t.prototype.parseAd=function(t){return console.log(t.InLine),[{id:t._attributes.id,adSystem:{version:t.InLine.AdSystem._attributes?t.InLine.AdSystem._attributes.version:null,name:t.InLine.AdSystem._cdata},adTitle:t.InLine.AdTitle._cdata,adType:y.inline,extensions:t.InLine.Extensions.Extension?this.parseExtensions(t.InLine.Extensions.Extension):[],creative:this.parseCreative(t.InLine.Creatives.Creative),error:t.InLine.Error?t.InLine.Error._text:null,sequence:t.InLine.Sequence?t.InLine.Sequence._text:null,description:t.InLine.Description._text,advertiser:t.InLine.Advertiser?t.InLine.Advertiser._text:null,pricing:{value:t.InLine.Pricing._text,currency:t.InLine.Pricing._attributes?t.InLine.Pricing._attributes.currency:null,model:t.InLine.Pricing._attributes?t.InLine.Pricing._attributes.model:null},survey:t.InLine.Survey._text||t.InLine.Survey._cdata,impressions:t.InLine.Impression?this.parseImpression(t.InLine.Impression):[]}]},t.prototype.parseCreative=function(t){var e=this,a=t;Array.isArray(t)||(a=[t]);var r=[];return a.forEach(function(t){var a={id:t._attributes?t._attributes.id:null,adID:t._attributes?t._attributes.AdID:null,sequence:t._attributes?t._attributes.sequence:null,skipoffset:t.Linear._attributes.skipoffset,trackings:e.parseTrackingEvents(t.Linear.TrackingEvents.Tracking),videoClicks:e.parseVideoClicks(t.Linear.VideoClicks),extensions:t.CreativeExtensions,mediaFiles:e.parseMediaFile(t.Linear.MediaFiles.MediaFile),duration:t.Linear.Duration._text,creativeType:F.linear};r.push(a)}),r},t.prototype.parseMediaFile=function(t){var e=t;Array.isArray(t)||(e=[t]);var a=[];return e.forEach(function(t){var e={id:t._attributes?t._attributes.id:null,height:t._attributes?t._attributes.height:null,width:t._attributes?t._attributes.width:null,delivery:t._attributes?t._attributes.delivery:null,codec:t._attributes?t._attributes.codec:null,mimetype:t._attributes?t._attributes.type:null,apiFramework:t._attributes?t._attributes.apiFramework:null,bitrate:t._attributes?t._attributes.bitrate:null,minBitrate:t._attributes?t._attributes.minBitrate:null,maxBitrate:t._attributes?t._attributes.maxBitrate:null,scalable:t._attributes?t._attributes.scalable:null,maintainAspectRatio:t._attributes?t._attributes.maintainAspectRatio:null,uri:t._cdata};a.push(e)}),a},t.prototype.parseTrackingEvents=function(t){var e=t;Array.isArray(t)||(e=[t]);var a=[];return e.forEach(function(t){var e={uri:t._cdata,event:t._attributes?t._attributes.event:null};a.push(e)}),a},t.prototype.parseVideoClicks=function(t){var e={clickTrackings:[],clickThrough:{uri:"",id:""}};if(t.ClickThrough&&(e.clickThrough={uri:t.ClickThrough._cdata,id:t.ClickThrough._attributes?t.ClickThrough._attributes.id:null}),t.clickTrackings){var a=t.clickTrackings;Array.isArray(t.clickTrackings)||(a=[a]),e.clickTrackings=[],a.forEach(function(t){e.clickTrackings&&e.clickTrackings.push({uri:t._cdata,id:t._attributes?t._attributes.id:null})})}if(t.customClicks){var r=t.customClicks;Array.isArray(t.customClicks)||(r=[r]),e.customClicks=[],r.forEach(function(t){e.customClicks&&e.customClicks.push({uri:t._cdata,id:t._attributes?t._attributes.id:null})})}return e},t.prototype.parseExtensions=function(t){var e=t;Array.isArray(t)||(e=[t]);var a=[];return e.forEach(function(t){var e={value:t._text,extensionType:t._attributes?t._attributes.type:null};a.push(e)}),a},t.prototype.parseImpression=function(t){console.log(t._cdata);var e=t;Array.isArray(t)||(e=[t]);var a=[];return e.forEach(function(t){a.push({uri:t._cdata})}),a},t}(),w=new P;t.VMAPParser=P,t.default=w,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=browser.js.map
